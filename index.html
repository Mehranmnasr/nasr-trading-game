<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¨Ø§Ø²ÛŒ ØªØ±ÛŒØ¯ Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ù†ØµØ±</title>
  <!-- Lightweight Charts -->
  <script src="https://unpkg.com/lightweight-charts@4.1.2/dist/lightweight-charts.standalone.production.js"></script>
  <!-- Chart.js for RSI -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.0.0/dist/chartjs-plugin-annotation.min.js"></script>
  <style>
    body {
      background-color: #003366;
      color: white;
      font-family: sans-serif;
      direction: rtl;
      text-align: center;
      margin: 20px;
    }
    #timeFrameTabs {
      margin-bottom: 10px;
    }
    .tab {
      padding: 10px 8px;
      margin: 0 5px;
      border: 1px solid #555;
      cursor: pointer;
      display: inline-block;
      background-color: #1e1e1e;
    }
    .tab.active {
      background-color: #007bff;
      color: white;
      border-color: #007bff;
    }
    .timeframe-tab {
      padding: 5px 4px; /* ØªØºÛŒÛŒØ± Ú©Ø±Ø¯ */
      margin: 0 2.5px; /* ØªØºÛŒÛŒØ± Ú©Ø±Ø¯ */
      border: 1px solid #555;
      cursor: pointer;
      display: inline-block;
      background-color: #1e1e1e;
      font-size: 14px; /* Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ */
    }
    .timeframe-tab.active { /* Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ */
      background-color: #007bff;
      color: white;
      border-color: #007bff;
    }
    .coin-tab {
      padding: 6px 8px;
      margin: 2px 3px;
      font-size: 12px;
      background-color: #1e1e1e;
      border: 1px solid #555;
      display: inline-block;
      width: 100px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .coin-tab.active {
      background-color: #0056b3;
      border-color: #0056b3;
    }
    #chartContainer {
      width: 100%;
      max-width: 400px;
      background-color: #0d1b2a;
      aspect-ratio: 1;
      margin: auto;
      border-radius: 8px;
      overflow: hidden;
    }
    #rsiChartContainer {
      width: 300px;
      height: 150px;
      background-color: white;
      margin: 20px auto;
      border-radius: 6px;
    }
    .btn {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
    }
    .upgrade-btn {
      padding: 8px 12px; /* Ú©Ù…ÛŒ Ú©ÙˆÚ†Ú©ØªØ± */
      margin: 2px 1px; /* Ú©Ù…ÛŒ Ú©ÙˆÚ†Ú©ØªØ± */
      font-size: 14px; /* Ú©Ù…ÛŒ Ú©ÙˆÚ†Ú©ØªØ± */
      cursor: pointer;
      border: none;
      border-radius: 4px;
      background-color: #007bff; /* Ø±Ù†Ú¯ Ø¢Ø¨ÛŒ */
      color: white;
    }
    .upgrade-btn:disabled {
      background-color: #6c757d; /* Ø±Ù†Ú¯ Ø®Ø§Ú©Ø³ØªØ±ÛŒ ÙˆÙ‚ØªÛŒ ØºÛŒØ±ÙØ¹Ø§Ù„ */
      cursor: not-allowed;
    }
    .info {
      margin-top: 10px;
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    select, input {
      padding: 6px;
      font-size: 14px;
      border-radius: 4px;
      border: 1px solid #555;
      background-color: #1e1e1e;
      color: white;
    }
    #freezePriceBtn {
      margin-top: 10px;
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
      display: block;
      margin: 10px auto 0;
    }
    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
    }
    /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Øª Ú©ÛŒÙ Ù¾ÙˆÙ„ */
    #walletCard {
      display: none;
      position: fixed;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      color: black;
      padding: 20px;
      border-radius: 8px;
      width: 320px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      z-index: 1000;
      cursor: pointer;
    }
    #walletCard ul {
      text-align: right;
      max-height: 200px;
      overflow-y: auto;
      padding-right: 20px;
    }
    #walletCard li {
      list-style: none;
      padding: 8px;
      border-bottom: 1px solid #eee;
    }
    #walletCard li:last-child {
      border-bottom: none;
    }
    #walletTab {
      background-color: #28a745; /* Ø±Ù†Ú¯ Ø³Ø¨Ø² */
    }
    #walletTab.active {
      background-color: #218838; /* Ø±Ù†Ú¯ Ø³Ø¨Ø² ØªÛŒØ±Ù‡â€ŒØªØ± */
    }
    /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Øª Ø§Ø±ØªÙ‚Ø§Ø¡ */
    #upgradeCard {
      display: none;
      position: fixed;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      color: black;
      padding: 20px;
      border-radius: 8px;
      width: 320px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      z-index: 1000;
      cursor: pointer;
    }
    #upgradeCard .upgrade-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    #upgradeCard .upgrade-item:last-child {
      border-bottom: none;
    }
    #upgradeTab {
      background-color: #6f42c1; /* Ø±Ù†Ú¯ Ø¨Ù†ÙØ´ */
    }
    #upgradeTab.active {
      background-color: #5a32a3; /* Ø±Ù†Ú¯ Ø¨Ù†ÙØ´ ØªÛŒØ±Ù‡â€ŒØªØ± */
    }
    .upgrade-tab-inactive {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h1>Ø¨Ø§Ø²ÛŒ ØªØ±ÛŒØ¯ Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ù†ØµØ±</h1>
  <div id="timeFrameTabs">
    <span class="tab" id="infoTab">â•</span>
    <div id="infoCard" style="display: none;
        position: fixed;
        top: 70px;
        left: 50%;
        transform: translateX(-50%);
        background: white;
        color: black;
        padding: 20px;
        border-radius: 8px;
        width: 300px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        cursor: pointer;
        z-index: 1000;">
      <h3>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø±Ø²</h3>
      <p>Ø§Ø³Ù… Ø§Ø±Ø²: <span id="coinNameDisplay">Ø¨ÛŒØªÚ©ÙˆÛŒÙ†</span></p>
      <p>Ù…Ø§Ø±Ú©Øª Ú©Ù¾: <span id="marketCap">336.0B</span></p>
      <p>ØªØ¹Ø¯Ø§Ø¯ Ø¹Ø±Ø¶Ù‡ Ú©Ù„: <span id="totalSupplyDisplay">21.00M</span></p>
      <!-- Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡: Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ù…ÛŒÙ†Ù†Ø³ Ø¨ÛŒØªÚ©ÙˆÛŒÙ† -->
      <p id="dominanceDisplay" style="display: none;">Ø¯Ø§Ù…ÛŒÙ†Ù†Ø³ Ø¨ÛŒØªÚ©ÙˆÛŒÙ†: <span id="bitcoinDominanceValue">40%</span></p>
      <!-- Ù¾Ø§ÛŒØ§Ù† Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ -->
      <p>Ù…ÛŒØ²Ø§Ù† Ø³Ú©Ù‡ Ù‡Ø§ÛŒ Ø§Ø±Ø² Ø¨ØµÙˆØ±Øª Ø¯Ø±ØµØ¯: <span id="percentRemaining">100%</span></p>
      <p>Ù…ÛŒØ²Ø§Ù† Ø³Ú©Ù‡ Ù‡Ø§ÛŒ Ø®Ø±ÛŒØ¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø±Ø² Ø¨ØµÙˆØ±Øª Ø¯Ø±ØµØ¯: <span id="percentBought">0%</span></p>
      <hr style="margin: 10px 0;">
      <h4>ØµÙ†Ø¯ÙˆÙ‚ Ù†Ù‚Ø¯ÛŒÙ†Ú¯ÛŒ</h4>
      <p>Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØµÙ†Ø¯ÙˆÙ‚: $<span id="liquidityPoolValue">100000</span></p>
      <div style="margin-top: 8px;">
        <button class="btn" onclick="depositToPool(100000)" style="background-color:#28a745; font-size:12px; padding:4px 8px; margin:2px;">+ 100K</button>
        <button class="btn" onclick="depositToPool(1000000)" style="background-color:#28a745; font-size:12px; padding:4px 8px; margin:2px;">+ 1M</button>
        <button class="btn" onclick="depositToPool(10000000)" style="background-color:#28a745; font-size:12px; padding:4px 8px; margin:2px;">+ 10M</button>
      </div>
      <div style="margin-top: 6px;">
        <button class="btn" onclick="withdrawFromPool(100000)" style="background-color:#dc3545; font-size:12px; padding:4px 8px; margin:2px;">- 100K</button>
        <button class="btn" onclick="withdrawFromPool(1000000)" style="background-color:#dc3545; font-size:12px; padding:4px 8px; margin:2px;">- 1M</button>
        <button class="btn" onclick="withdrawFromPool(10000000)" style="background-color:#dc3545; font-size:12px; padding:4px 8px; margin:2px;">- 10M</button>
      </div>
      <small>Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ø¨Ø±Ú¯Ù‡ØŒ Ø±ÙˆÛŒ Ø§ÛŒÙ†Ø¬Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†</small>
    </div>
    <div id="secretForm" style="display: none; margin-top: 20px;">
      <input type="text" id="secretCode" placeholder="Ú©Ø¯ Ù…Ø®ÙÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" />
      <input type="number" id="secretAmount" placeholder="Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø§Ø±" />
      <button id="applySecret">ØªØ£ÛŒÛŒØ¯</button>
    </div>
    <span class="tab" id="secretTab">â•</span>
    <span class="tab" id="myCoinTab">ğŸª™</span>
    <div id="myCoinForm" style="display: none;
        position: fixed;
        top: 70px;
        left: 50%;
        transform: translateX(-50%);
        background: white;
        color: black;
        padding: 20px;
        border-radius: 8px;
        width: 320px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        z-index: 1000;">
      <h3>Ø³Ø§Ø®Øª Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ø´Ø®ØµÛŒ</h3>
      <p>Ù‡Ø²ÛŒÙ†Ù‡ Ø³Ø§Ø®Øª: <strong>100 Ø¯Ù„Ø§Ø±</strong></p>
      <input type="text" id="coinNameInput" placeholder="Ù†Ø§Ù… Ø§Ø±Ø² (Ù…Ø«Ù„Ø§Ù‹ Ù†ØµØ±â€ŒÚ©ÙˆÛŒÙ†)" style="width: 100%; margin: 8px 0; padding: 6px;">
      <input type="number" id="totalSupplyInput" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø³Ú©Ù‡â€ŒÙ‡Ø§ (Ù…Ø«Ù„Ø§Ù‹ 1000000)" min="1000" style="width: 100%; margin: 8px 0; padding: 6px;">
      <input type="number" id="listingPriceInput" placeholder="Ù‚ÛŒÙ…Øª Ù„ÛŒØ³Øª Ø´Ø¯Ù† (Ø¯Ù„Ø§Ø±)" min="0.01" step="0.01" style="width: 100%; margin: 8px 0; padding: 6px;">
      <!-- Ù‚Ø³Ù…Øª Ø¬Ø¯ÛŒØ¯: Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¨Ú©Ù‡ -->
      <label for="networkSelect">Ø´Ø¨Ú©Ù‡ Ø§Ø±Ø²:</label>
      <select id="networkSelect" style="width: 100%; margin: 8px 0; padding: 6px;">
        <option value="native">Ø¨ÙˆÙ…ÛŒ</option>
        <option value="bitcoin">Ø¨ÛŒØªÚ©ÙˆÛŒÙ†</option>
        <option value="ethereum">Ø§ØªØ±ÛŒÙˆÙ…</option>
        <option value="binance">Ø¨Ø§ÛŒÙ†Ù†Ø³ Ú©ÙˆÛŒÙ†</option>
      </select>
      <!-- Ù¾Ø§ÛŒØ§Ù† Ù‚Ø³Ù…Øª Ø¬Ø¯ÛŒØ¯ -->
      <div style="margin-top: 10px;">
        <button id="createCoinBtn" class="btn" style="background-color: #28a745; color: white; width: 100%;">Ø³Ø§Ø®Øª Ø§Ø±Ø² ğŸš€</button>
      </div>
      <small style="display: block; margin-top: 10px; cursor: pointer;" id="closeMyCoinForm">Ù„ØºÙˆ</small>
    </div>
    <!-- ØªØ¨ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ -->
    <span class="tab" id="profileTab">ğŸ§‘ğŸ»â€âœˆï¸</span>
    <!-- Ú©Ø§Ø±Øª Ù¾Ø±ÙˆÙØ§ÛŒÙ„ -->
    <div id="profileCard" style="display: none;
        position: fixed;
        top: 70px;
        left: 50%;
        transform: translateX(-50%);
        background: white;
        color: black;
        padding: 20px;
        border-radius: 8px;
        width: 300px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        cursor: pointer;
        z-index: 1000;">
      <h3>Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ù…Ø¹Ø§Ù…Ù„Ù‡â€ŒÚ¯Ø±</h3>
      <p>Ù†Ø§Ù…: <strong id="traderName">Ù¾Ù„ÛŒØ±</strong></p>
      <p>Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡: $1,000</p>
      <p>Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ: $<span id="currentBalanceProfile">1000</span></p>
      <p>Ø³ÙˆØ¯/Ø²ÛŒØ§Ù† Ú©Ù„: <span id="totalPnLPercent">0.00%</span></p>
      <!-- Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø³Ø·Ø­ Ú©Ø§Ø±Ø¨Ø±ÛŒ -->
      <p>Ø³Ø·Ø­ Ú©Ø§Ø±Ø¨Ø±ÛŒ: <span id="userLevel">ØªØ§Ø²Ù‡ Ú©Ø§Ø±</span> <span id="userStars">â­</span></p>
      <!-- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ -->
      <small>Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ†ØŒ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</small>
    </div>
    <!-- ØªØ¨ Ú©ÛŒÙ Ù¾ÙˆÙ„ -->
    <span class="tab" id="walletTab">ğŸ’¼</span>
    <!-- Ú©Ø§Ø±Øª Ú©ÛŒÙ Ù¾ÙˆÙ„ -->
    <div id="walletCard" style="display: none;
        position: fixed;
        top: 70px;
        left: 50%;
        transform: translateX(-50%);
        background: white;
        color: black;
        padding: 20px;
        border-radius: 8px;
        width: 320px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        z-index: 1000;
        cursor: pointer;">
      <h3>Ú©ÛŒÙ Ù¾ÙˆÙ„ Ù…Ù†</h3>
      <ul id="walletList">
        <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
      </ul>
      <small>Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ†ØŒ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</small>
    </div>
    <!-- ØªØ¨ Ø§Ø±ØªÙ‚Ø§Ø¡ (Diamond) -->
    <span class="tab" id="upgradeTab">ğŸ’</span>
    <!-- Ú©Ø§Ø±Øª Ø§Ø±ØªÙ‚Ø§Ø¡ -->
    <div id="upgradeCard" style="display: none;
        position: fixed;
        top: 70px;
        left: 50%;
        transform: translateX(-50%);
        background: white;
        color: black;
        padding: 20px;
        border-radius: 8px;
        width: 320px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        z-index: 1000;
        cursor: pointer;">
      <h3>Ø§Ø±ØªÙ‚Ø§ÛŒ Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„</h3>
      <div class="upgrade-item">
        <span>Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø±Ø¹Øª ØªØ±Ø§Ú©Ù†Ø´ (TPS)</span>
        <button class="upgrade-btn" id="upgradeTpsBtn">Ø®Ø±ÛŒØ¯</button>
      </div>
      <div class="upgrade-item">
        <span>Ø¨Ù‡Ø¨ÙˆØ¯ Ø§Ù…Ù†ÛŒØª (RSA512 -> SHA256)</span>
        <button class="upgrade-btn" id="upgradeSecurityBtn">Ø®Ø±ÛŒØ¯</button>
      </div>
      <div class="upgrade-item">
        <span>ØªØºÛŒÛŒØ± Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ø§Ø¬Ù…Ø§Ø¹ (PoW -> PoS)</span>
        <button class="upgrade-btn" id="upgradeConsensusBtn">Ø®Ø±ÛŒØ¯</button>
      </div>
      <div class="upgrade-item">
        <span>Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± NFT</span>
        <button class="upgrade-btn" id="upgradeNftBtn">Ø®Ø±ÛŒØ¯</button>
      </div>
      <div class="upgrade-item">
        <span>Ù…Ø§Ø±Ú©ØªÛŒÙ†Ú¯ Ùˆ Ø¨Ø±Ù†Ø¯ÛŒÙ†Ú¯</span>
        <button class="upgrade-btn" id="upgradeMarketingBtn">Ø®Ø±ÛŒØ¯</button>
      </div>
      <small>Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ†ØŒ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</small>
    </div>
  </div>
  <span class="timeframe-tab active" data-frame="live">30 Ø¯Ù‚ÛŒÙ‚Ù‡</span>
  <span class="timeframe-tab" data-frame="hour1">1 Ø³Ø§Ø¹ØªÙ‡</span>
  <span class="timeframe-tab" data-frame="hour4">4 Ø³Ø§Ø¹ØªÙ‡</span>
  <span class="timeframe-tab" data-frame="day1">Ø±ÙˆØ²Ø§Ù†Ù‡</span>
  <span class="timeframe-tab" data-frame="week1">Ù‡ÙØªÚ¯ÛŒ</span> <!-- Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ -->
  <span class="tab coin-tab" id="coinNameTab">Ø¨ÛŒØªÚ©ÙˆÛŒÙ†</span>
  <span class="tab coin-tab" id="coinEthereumTab">Ø§ØªØ±ÛŒÙˆÙ…</span> <!-- Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ -->
  <span class="tab coin-tab" id="coinBinanceTab">Ø¨Ø§ÛŒÙ†Ù†Ø³ Ú©ÙˆÛŒÙ†</span> <!-- Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ -->
  <span class="tab coin-tab" id="personalCoinTab" style="display: none;"></span>
  <div id="calendarContainer" style="margin-top: 20px; background: white; color: black; padding: 1px; border-radius: 6px; width: 100px; font-size: 13px; margin: auto;">
    <p>ØªØ§Ø±ÛŒØ® ÙØ¹Ù„ÛŒ: <span id="virtualDayDisplay">1/1/2022</span></p>
  </div>
  <button id="freezePriceBtn" title="ÙØ±ÛŒØ² Ù‚ÛŒÙ…Øª (Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø§Ù…Ù¾/Ø¯Ø§Ù…Ù¾)">â¸ï¸</button>
  <div id="chartContainer">
    <div id="priceChart" style="width: 100%; height: 100%;"></div>
  </div>
  <div id="rsiChartContainer">
    <canvas id="rsiChart"></canvas>
  </div>
  <div id="controlPanel">
    <div class="info">
      <span>Ù…ÙˆØ¬ÙˆØ¯ÛŒ: <span id="balance">1000</span> Ø¯Ù„Ø§Ø±</span>
    </div>
    <div class="info">
      <span>Ù‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ Ø§Ø±Ø²: $<span id="currentPrice">16000</span> (<span id="priceChange24h">+0.00%</span>)</span>
    </div>
    <div class="info">
      <span>Ø­Ø¯ Ø¶Ø±Ø± ÙØ¹Ø§Ù„: $<span id="stopLossDisplay">â€”</span></span>
    </div>
    <div>
      <button class="btn" id="buyBtn" style="background-color: #28a745;">Ø®Ø±ÛŒØ¯ ğŸŸ¢</button>
      <button class="btn" id="sellBtn" style="background-color: #dc3545;">ÙØ±ÙˆØ´ ğŸ”´</button>
    </div>
    <div class="info">
      <label for="tradePercent">Ùª Ù…Ù‚Ø¯Ø§Ø± Ø®Ø±ÛŒØ¯/ÙØ±ÙˆØ´:</label>
      <select id="tradePercent">
        <option value="10">10%</option>
        <option value="30">30%</option>
        <option value="50">50%</option>
        <option value="100">100%</option>
      </select>
    </div>
    <div class="info">
      <label for="orderType">Ù†ÙˆØ¹ Ø§ÙˆØ±Ø¯Ø±:</label>
      <select id="orderType">
        <option value="market">Ù…Ø§Ø±Ú©Øª</option>
        <option value="limit">Ù„ÛŒÙ…ÛŒØª</option>
      </select>
    </div>
    <div class="info" id="limitPriceInput" style="display: none;">
      <label for="limitPrice">Ù‚ÛŒÙ…Øª Ø¯Ù„Ø®ÙˆØ§Ù‡:</label>
      <input type="number" id="limitPrice" placeholder="Ù‚ÛŒÙ…Øª Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø®Ø±ÛŒØ¯/ÙØ±ÙˆØ´" min="0" step="any" />
    </div>
    <div class="info">
      <label for="stopLossPercent">Ùª Ø­Ø¯ Ø¶Ø±Ø±:</label>
      <select id="stopLossPercent">
        <option value="5">5Ùª</option>
        <option value="10">10Ùª</option>
        <option value="15">15Ùª</option>
      </select>
    </div>
    <div class="info">
      <p>ØªØ¹Ø¯Ø§Ø¯ Ø§Ø±Ø² Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒâ€ŒØ´Ø¯Ù‡: <span id="coinAmount">0</span> Ø¹Ø¯Ø¯</p>
      <p>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒâ€ŒØ´Ø¯Ù‡: $<span id="avgPrice">0</span></p>
      <p>Ø§Ø±Ø²Ø´ Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ÛŒ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡: $<span id="assetValue">0</span></p>
      <p>Ø³ÙˆØ¯/Ø¶Ø±Ø± Ú©Ù„: $<span id="profitLoss">0</span></p>
    </div>
    <div class="info" style="margin-top: 10px;">
      <button id="transferToWalletBtn" class="btn" style="background-color: #ffc107; color: black;">Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„</button>
      <button id="transferFromWalletBtn" class="btn" style="background-color: #6f42c1; color: white;">Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ø² Ú©ÛŒÙ Ù¾ÙˆÙ„</button>
    </div>
    <div class="info" style="margin-top: 10px;">
      <button id="resetBtn" class="btn" style="background-color: #ff4d4d; color: white;">Ø±ÛŒØ³Øª Ø¨Ø§Ø²ÛŒ ğŸ”„</button>
      <button id="burnBalanceBtn" class="btn" style="background-color: #ff6600; color: white; margin-right: 10px;">Ø³ÙˆØ²Ø§Ù†Ø¯Ù† Ø¯Ù„Ø§Ø± ğŸ”¥</button>
    </div>
  </div>
  <script>
    // ========== ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ RSI ==========
    function calculateRSI(data, period) {
      let rsi = [];
      for (let i = 0; i < data.length; i++) {
        if (i < period) {
          rsi.push(null);
          continue;
        }
        let gains = 0, losses = 0;
        for (let j = i - period + 1; j <= i; j++) {
          let diff = data[j] - data[j - 1];
          if (diff >= 0) gains += diff;
          else losses -= diff;
        }
        let avgGain = gains / period;
        let avgLoss = losses / period;
        let rs = avgLoss === 0 ? 100 : avgGain / avgLoss;
        rsi.push((100 - (100 / (1 + rs))).toFixed(2));
      }
      return rsi;
    }
    // ========== ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ SMA ==========
    function calculateSMA(data, period) {
      let sma = [];
      for (let i = 0; i < data.length; i++) {
        if (i < period - 1) {
          sma.push(null);
          continue;
        }
        let sum = 0;
        for (let j = i - period + 1; j <= i; j++) {
          sum += data[j];
        }
        sma.push(sum / period);
      }
      return sma;
    }
    // ========== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø«Ø§Ø¨Øª ==========
    const rsiPeriod = 14;
    const smaPeriod = 50;
    const globalMaxHistory = 250; // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
    // ========== ØªØ§Ø¨Ø¹ Ø³Ø§Ø®Øª Ø¯Ø§Ø¯Ù‡ Ø§ÙˆÙ„ÛŒÙ‡ ==========
    function createInitialTimeframeData(price) {
      return {
        labels: [1],
        priceData: [price],
        barData: [0],
        rsiData: calculateRSI([price], rsiPeriod),
        smaData: calculateSMA([price], smaPeriod) // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
      };
    }
    // ========== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ ==========
    let virtualDay = 1;
    let virtualMonth = 1;
    let virtualYear = 2022;
    let moveCounter = 0;
    let balance = 1000;
    let isPriceFrozen = false;
    // ========== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ ==========
    let traderName = "Ù¾Ù„ÛŒØ±";
    let initialBalance = 1000;
    let liquidityPool = 100000; // ØµÙ†Ø¯ÙˆÙ‚ Ù†Ù‚Ø¯ÛŒÙ†Ú¯ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    const volatilityUp = 0.03;
    const volatilityDown = 0.029;
    const cycleLength = 2;
    // --- Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù…ÛŒÙ†Ù†Ø³ Ùˆ Ù‡Ù…Ø¨Ø³ØªÚ¯ÛŒ ---
    let currentBitcoinDominance = 40; // Ø´Ø±ÙˆØ¹ Ø¨Ø§ 40%
    let lastUpdatedMonth = virtualMonth; // Ø°Ø®ÛŒØ±Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ù…Ø§Ù‡ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
    const minDominance = 40;
    const maxDominance = 70;
    const minCorrelation = 0.30; // 30% Ù‡Ù…Ø¨Ø³ØªÚ¯ÛŒ ÙˆÙ‚ØªÛŒ Ø¯Ø§Ù…ÛŒÙ†Ù†Ø³ 40% Ø§Ø³Øª
    const maxCorrelation = 0.80; // 80% Ù‡Ù…Ø¨Ø³ØªÚ¯ÛŒ ÙˆÙ‚ØªÛŒ Ø¯Ø§Ù…ÛŒÙ†Ù†Ø³ 70% Ø§Ø³Øª
    // --- Ù¾Ø§ÛŒØ§Ù† Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ ---
    const timeFrameConfigs = {
      live: { maxPoints: 30, interval: 2000, timeframe: 'live' },
      hour1: { maxPoints: 50, interval: 3000, timeframe: 'hour1' }, // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
      hour4: { maxPoints: 100, interval: 4000, timeframe: 'hour4' }, // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
      day1: { maxPoints: 150, interval: 5000, timeframe: 'day1' }, // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
      week1: { maxPoints: 200, interval: 6000, timeframe: 'week1' } // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
    };
    let currentConfig = timeFrameConfigs.live;
    let currentIntervalId = null;
    // ========== Ø³Ø§Ø®ØªØ§Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ú†Ù†Ø¯ Ø§Ø±Ø² Ø¨Ø§ ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…â€ŒÙ‡Ø§ÛŒ Ù…Ø³ØªÙ‚Ù„ ==========
    let coins = {
      bitcoin: {
        name: "Ø¨ÛŒØªÚ©ÙˆÛŒÙ†",
        totalSupply: 21000000,
        livePrice: 16000, // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
        coinAmount: 0,
        avgPrice: 0,
        stopLossPrice: 0,
        price24hAgo: 16000, // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ - Ù…Ù‚Ø¯Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡ Ù‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ
        cycleStep: 0,
        timeframes: {
          live: createInitialTimeframeData(16000), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
          hour1: createInitialTimeframeData(16000), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
          hour4: createInitialTimeframeData(16000), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
          day1: createInitialTimeframeData(16000), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
          week1: createInitialTimeframeData(16000) // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
        }
      },
      // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§ØªØ±ÛŒÙˆÙ… Ùˆ Ø¨Ø§ÛŒÙ†Ù†Ø³ Ú©ÙˆÛŒÙ† Ø¨Ø§ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ùˆ price24hAgo
      ethereum: {
        name: "Ø§ØªØ±ÛŒÙˆÙ…",
        totalSupply: 120000000, // 120M
        livePrice: 1100, // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
        coinAmount: 0,
        avgPrice: 0,
        stopLossPrice: 0,
        price24hAgo: 1100, // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ - Ù…Ù‚Ø¯Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡ Ù‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ
        cycleStep: 0,
        timeframes: {
          live: createInitialTimeframeData(1100), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
          hour1: createInitialTimeframeData(1100), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
          hour4: createInitialTimeframeData(1100), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
          day1: createInitialTimeframeData(1100), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
          week1: createInitialTimeframeData(1100) // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
        }
      },
      binance: {
        name: "Ø¨Ø§ÛŒÙ†Ù†Ø³ Ú©ÙˆÛŒÙ†",
        totalSupply: 140000000, // 140M
        livePrice: 200, // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
        coinAmount: 0,
        avgPrice: 0,
        stopLossPrice: 0,
        price24hAgo: 200, // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ - Ù…Ù‚Ø¯Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡ Ù‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ
        cycleStep: 0,
        timeframes: {
          live: createInitialTimeframeData(200), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
          hour1: createInitialTimeframeData(200), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
          hour4: createInitialTimeframeData(200), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
          day1: createInitialTimeframeData(200), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
          week1: createInitialTimeframeData(200) // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
        }
      }
    };
    let currentCoin = 'bitcoin';
    let personalCoinKey = null;
    // ========== Ø§ÙˆØ±Ø¯Ø±Ù‡Ø§ÛŒ Ù„ÛŒÙ…ÛŒØª ==========
    let limitOrders = [];
    // ========== Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¬Ø¯ÛŒØ¯ ==========
    let wallet = {}; // ÛŒÚ© Ø´ÛŒØ¡ Ø®Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ø§Ø±Ø²Ù‡Ø§ÛŒ Ú©ÛŒÙ Ù¾ÙˆÙ„
    // ========== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ø¨Ø³ØªÚ¯ÛŒ (Ø§Ú©Ù†ÙˆÙ† Ù¾ÙˆÛŒØ§) ==========
    // const correlationFactor = 0.8; // 80% Ù‡Ù…Ø¨Ø³ØªÚ¯ÛŒ - Ø§ÛŒÙ† Ø¯ÛŒÚ¯Ø± Ø«Ø§Ø¨Øª Ù†ÛŒØ³Øª
    const independentFactor = 1 - maxCorrelation; // Ø­Ø¯Ø§Ú©Ø«Ø± Ù…Ø³ØªÙ‚Ù„ (20% ÙˆÙ‚ØªÛŒ Ù‡Ù…Ø¨Ø³ØªÚ¯ÛŒ 80% Ø§Ø³Øª)
    const independentVolatility = 0.01; // 1% Ù†ÙˆØ³Ø§Ù† Ù…Ø³ØªÙ‚Ù„
    // ========== Lightweight Charts ==========
    let priceChart = null;
    let candlestickSeries = null;
    let smaSeries = null; // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
    function initPriceChart() {
      const container = document.getElementById('priceChart');
      priceChart = LightweightCharts.createChart(container, {
        layout: {
          backgroundColor: '#0d1b2a',
          textColor: 'white',
        },
        grid: {
          vertLines: { color: '#1e3a5f' },
          horzLines: { color: '#1e3a5f' },
        },
        crosshair: {
          mode: LightweightCharts.CrosshairMode.Normal,
        },
        rightPriceScale: {
          borderColor: '#444',
          scaleMargins: { top: 0.1, bottom: 0.2 },
          textColor: '#666666',
        },
        timeScale: {
          borderColor: '#444',
          timeVisible: true,
          secondsVisible: false,
          textColor: '#666666',
        },
        handleScroll: {
          mouseWheel: true,
          pressedMouseMove: true,
        },
        handleScale: {
          axisPressedMouseMove: true,
          mouseWheel: true,
          pinch: true,
        },
      });
      candlestickSeries = priceChart.addCandlestickSeries({
        upColor: '#26a69a',
        downColor: '#ef5350',
        borderVisible: false,
        wickUpColor: '#26a69a',
        wickDownColor: '#ef5350',
      });
      // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø®Ø· SMA
      smaSeries = priceChart.addLineSeries({
        color: '#FF9800', // Ø±Ù†Ú¯ Ù†Ø§Ø±Ù†Ø¬ÛŒ
        lineWidth: 1
        // title: 'SMA 50' Ø§ÛŒÙ† Ø®Ø· Ø­Ø°Ù Ø´Ø¯
      });
    }
    function updatePriceChart() {
      const coin = getCurrentCoinData();
      const tfData = coin.timeframes[currentConfig.timeframe];
      const data = tfData.priceData.map((price, i) => {
        const time = Math.floor(Date.now() / 1000) - (tfData.priceData.length - i) * 60;
        const open = i === 0 ? price : tfData.priceData[i - 1];
        return {
          time: time,
          open: open,
          high: Math.max(price, open),
          low: Math.min(price, open),
          close: price
        };
      });
      const maxPoints = currentConfig.maxPoints || 50;
      candlestickSeries.setData(data.slice(-maxPoints));
      // Ø¢Ù¾Ø¯ÛŒØª SMA Ø¯Ø± Ù†Ù…ÙˆØ¯Ø§Ø±
      let smaData = tfData.priceData.map((price, i) => ({
        time: Math.floor(Date.now() / 1000) - (tfData.priceData.length - i) * 60,
        value: tfData.smaData[i]
      }));
      // ÙÙ‚Ø· Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± Ø¯Ø§Ø±Ù† (Ù…Ø«Ù„Ø§Ù‹ Ø¨Ø¹Ø¯ Ø§Ø² 50 ØªØ§) Ø±Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
      const filteredSmaData = smaData.filter(item => item.value !== null);
      if (filteredSmaData.length > 0) {
        smaSeries.setData(filteredSmaData.slice(-currentConfig.maxPoints));
      } else {
        smaSeries.setData([]);
      }
      if (data.length > 0) {
        priceChart.timeScale().fitContent();
      }
    }
    // ========== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø§Ø¶Ø§ÙÛŒ ==========
    // --- ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø§Ù…ÛŒÙ†Ù†Ø³ Ø¨ÛŒØªÚ©ÙˆÛŒÙ† Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø§Ù‡ ---
    function calculateBitcoinDominance(currentMonth) {
      // Ú†Ø±Ø®Ù‡ 4 Ù…Ø§Ù‡Ù‡: 40 -> 50 -> 60 -> 70 -> 40 ...
      // Ù…Ø§Ù‡ Ù‡Ø§: 1,2,3,4,5,6,7,8 -> Ù…Ù‚Ø¯Ø§Ø± Ú†Ø±Ø®Ù‡: (1-1)%4=0, (2-1)%4=1, (3-1)%4=2, (4-1)%4=3, (5-1)%4=0, ...
      // Ø§Ù†Ø¯ÛŒØ³ Ú†Ø±Ø®Ù‡: 0,1,2,3
      const cycleIndex = (currentMonth - 1) % 4;
      let dominance;
      switch(cycleIndex) {
        case 0:
          dominance = 40;
          break;
        case 1:
          dominance = 50;
          break;
        case 2:
          dominance = 60;
          break;
        case 3:
          dominance = 70;
          break;
        default:
          dominance = 40; // Ù¾ÛŒØ´â€ŒÙØ±Ø¶
      }
      return dominance;
    }
    // --- Ù¾Ø§ÛŒØ§Ù† ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ ---
    // --- ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‡Ù…Ø¨Ø³ØªÚ¯ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø§Ù…ÛŒÙ†Ù†Ø³ ---
    function calculateCorrelationFromDominance(dominance) {
        // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ÙØ±Ù…ÙˆÙ„ Ø®Ø·ÛŒ Ø¨ÛŒÙ† Ø¯Ùˆ Ù†Ù‚Ø·Ù‡: (40, 0.30) Ùˆ (70, 0.80)
        // Ø´ÛŒØ¨ = (0.80 - 0.30) / (70 - 40) = 0.50 / 30 = 0.016666...
        // y - y1 = m(x - x1) -> y = m(x - x1) + y1
        // y = 0.016666... * (dominance - 40) + 0.30
        const slope = (maxCorrelation - minCorrelation) / (maxDominance - minDominance);
        const calculatedCorrelation = slope * (dominance - minDominance) + minCorrelation;
        // Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± Ø¯Ø± Ø¨Ø§Ø²Ù‡ [minCorrelation, maxCorrelation] Ø¨Ø§Ø´Ø¯
        return Math.min(Math.max(calculatedCorrelation, minCorrelation), maxCorrelation);
    }
    // --- Ù¾Ø§ÛŒØ§Ù† ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ ---
    function getCyclicFactor(currentStep, cycleLength) {
      const phase = (currentStep % cycleLength) / cycleLength;
      let factor;
      if (phase < 0.5) {
        factor = 1 + (phase * 1.2) * 0.05 + 0.002 * Math.sin(phase * Math.PI * 1);
      } else {
        const subPhase = (phase - 0.5) * 1.2;
        factor = 1 - (subPhase * 0.049) + 0.002 * Math.sin(subPhase * Math.PI * 1);
      }
      return factor;
    }
    function formatMarketCap(valueInMillions) {
      if (valueInMillions >= 1_000_000) { // Ø§Ú¯Ø± Ù…Ù‚Ø¯Ø§Ø± Ø¨ÛŒØ´ØªØ± ÛŒØ§ Ù…Ø³Ø§ÙˆÛŒ 1000000 Ù…ÛŒÙ„ÛŒÙˆÙ† Ø¨ÙˆØ¯ (ÛŒØ¹Ù†ÛŒ 1 ØªØ±ÛŒÙ„ÛŒÙˆÙ† Ø¯Ù„Ø§Ø±)
        return (valueInMillions / 1_000_000).toFixed(1) + "T"; // ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± 1000000 Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø§ T
      } else if (valueInMillions >= 1000) { // Ø§Ú¯Ø± Ø¨ÛŒÙ† 1000 ØªØ§ 999999 Ù…ÛŒÙ„ÛŒÙˆÙ† Ø¨ÙˆØ¯
        return (valueInMillions / 1000).toFixed(1) + "B"; // ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± 1000 Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø§ B
      } else { // Ø§Ú¯Ø± Ú©Ù…ØªØ± Ø§Ø² 1000 Ù…ÛŒÙ„ÛŒÙˆÙ† Ø¨ÙˆØ¯
        return valueInMillions.toFixed(1) + "M"; // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø§ M
      }
    }
    // ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ÙØ±Ù…Øª Ø¹Ø±Ø¶Ù‡ Ú©Ù„
    function formatTotalSupply(value) {
      if (value >= 1_000_000_000) {
        return (value / 1_000_000_000).toFixed(2) + "B";
      } else if (value >= 1_000_000) {
        return (value / 1_000_000).toFixed(2) + "M";
      } else {
        return value.toLocaleString(); // Ø¨Ø±Ø§ÛŒ Ø§Ø¹Ø¯Ø§Ø¯ Ú©ÙˆÚ†Ú©ØªØ±ØŒ Ø¨Ø§ Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡ Ù‡Ø²Ø§Ø± Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯
      }
    }
    function getCurrentCoinData() {
      return coins[currentCoin];
    }
    function switchToCoin(coinKey) {
      if (!coins[coinKey]) return;
      currentCoin = coinKey;
      const newCoin = getCurrentCoinData();
      document.getElementById("coinNameDisplay").innerText = newCoin.name;
      // --- Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ù†Ù…Ø§ÛŒØ´/Ø¹Ø¯Ù… Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ù…ÛŒÙ†Ù†Ø³ Ø¯Ø± Ú©Ø§Ø±Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª ---
      const dominanceDisplay = document.getElementById("dominanceDisplay");
      if (coinKey === 'bitcoin') {
        dominanceDisplay.style.display = 'block';
        document.getElementById("bitcoinDominanceValue").innerText = currentBitcoinDominance.toFixed(2) + "%";
      } else {
        dominanceDisplay.style.display = 'none';
      }
      // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ ---
      // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ÙØ±Ù…Øª Ø¹Ø±Ø¶Ù‡ Ú©Ù„
      document.getElementById("totalSupplyDisplay").innerText = formatTotalSupply(newCoin.totalSupply);
      // --- Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ø¢Ù¾Ø¯ÛŒØª Ù…Ø§Ø±Ú©Øª Ú©Ù¾ Ø¯Ø± Ú©Ø§Ø±Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª ---
      const marketCapInMillions = (newCoin.livePrice * newCoin.totalSupply) / 1_000_000;
      document.getElementById("marketCap").innerText = formatMarketCap(marketCapInMillions);
      // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ ---
      updateCoinPercentages();
      updateDisplay();
      updatePriceChart();
      const tfData = newCoin.timeframes[currentConfig.timeframe];
      rsiChart.data.labels = tfData.labels.slice(-currentConfig.maxPoints);
      rsiChart.data.datasets[0].data = tfData.rsiData.slice(-currentConfig.maxPoints);
      rsiChart.update();
      // --- Ø¨Ø®Ø´ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„Ø§Ø³ 'active' ØªØ¨â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø² ---
      // Ø§ÙˆÙ„ Ø§Ø² Ù‡Ù…Ù‡ ØªØ¨â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø²ØŒ Ú©Ù„Ø§Ø³ 'active' Ø±Ùˆ Ø­Ø°Ù Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      document.querySelectorAll('.coin-tab').forEach(tab => tab.classList.remove('active'));
      // Ø¨Ø¹Ø¯ØŒ ØªØ¨ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§Ø±Ø² ÙØ¹Ù„ÛŒ Ø±Ùˆ Ù¾ÛŒØ¯Ø§ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ùˆ Ú©Ù„Ø§Ø³ 'active' Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      // Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø²Ù‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
      if (coinKey === 'bitcoin') {
        document.getElementById('coinNameTab').classList.add('active');
      } else if (coinKey === 'ethereum') {
        document.getElementById('coinEthereumTab').classList.add('active');
      } else if (coinKey === 'binance') {
        document.getElementById('coinBinanceTab').classList.add('active');
      }
      // Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø² Ø´Ø®ØµÛŒ
      else if (personalCoinKey && coinKey === personalCoinKey) {
        document.getElementById('personalCoinTab').classList.add('active');
      }
      // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ ---
      // --- Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª ØªØ¨ Ø§Ø±ØªÙ‚Ø§Ø¡ ---
      updateUpgradeTabStatus();
      // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ ---
    }
    function checkLimitOrdersForCoin(coinKey, newPrice) {
      // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø§Ù„Ø§Ù† ÙÙ‚Ø· Ú†Ú© Ù…ÛŒâ€ŒÚ©Ù†Ù‡ Ú©Ù‡ Ø¢ÛŒØ§ Ø§ÙˆØ±Ø¯Ø±Ù‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§ÛŒÙ† Ø§Ø±Ø² (coinKey) Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´Ù† ÛŒØ§ Ù†Ù‡
      for (let i = limitOrders.length - 1; i >= 0; i--) {
        const order = limitOrders[i];
        if (order.coinKey !== coinKey) continue; // ÙÙ‚Ø· Ø§ÙˆØ±Ø¯Ø±Ù‡Ø§ÛŒ Ø§ÛŒÙ† Ø§Ø±Ø²
        const coin = coins[coinKey]; // Ø§Ø² Ø´ÛŒØ¡ Ø§Ø±Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
        if (order.type === 'buy' && newPrice <= order.price) {
          const amountToSpend = order.amount;
          if (balance >= amountToSpend) {
            const coinsBought = amountToSpend / newPrice;
            const onePercentSupply = coin.totalSupply * 0.01;
            balance -= amountToSpend;
            coin.coinAmount += coinsBought;
            coin.avgPrice = coin.coinAmount > 0
              ? ((coin.avgPrice * (coin.coinAmount - coinsBought)) + (newPrice * coinsBought)) / coin.coinAmount
              : newPrice;
            if (!isPriceFrozen && coinsBought >= onePercentSupply) {
              // ØªØ£Ø«ÛŒØ± pump/dump Ø±ÙˆÛŒ ØµÙ†Ø¯ÙˆÙ‚ Ùˆ ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª Ø§ØµÙ„ÛŒ Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ†
              const newPumpedPrice = newPrice * 1.05;
              applyPriceChangeForCoin(coinKey, newPumpedPrice); // ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª Ø§Ø±Ø² Ø®Ø§Øµ
              // ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ† (Ø§ØµÙ„ÛŒ) Ø¨Ø±Ø§ÛŒ ØªØ£Ø«ÛŒØ± Ø±ÙˆÛŒ Ø¨Ù‚ÛŒÙ‡
              if (coinKey === 'bitcoin') {
                 coins.bitcoin.livePrice = newPumpedPrice;
              }
              alert(`ğŸ”¥ Ø®Ø±ÛŒØ¯ Ø¨Ø²Ø±Ú¯ (${(coinsBought / coin.totalSupply * 100).toFixed(2)}%) Ø±ÙˆÛŒ ${coin.name}!`);
            } else {
              // ÙÙ‚Ø· Ù†Ù…Ø§ÛŒØ´ Ø§Ø±Ø² ÙØ¹Ù„ÛŒ Ø±Ø§ Ø¢Ù¾Ø¯ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø§Ú¯Ø± ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
              if (coinKey === currentCoin) {
                updateDisplay();
                updateCoinPercentages(); // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø±ØµØ¯ Ø¨Ø¹Ø¯ Ø§Ø² Ø®Ø±ÛŒØ¯
              }
            }
            limitOrders.splice(i, 1);
            alert(`âœ… Ø§ÙˆØ±Ø¯Ø± Ø®Ø±ÛŒØ¯ Ù„ÛŒÙ…ÛŒØª Ø´Ù…Ø§ Ø¨Ù‡ Ù‚ÛŒÙ…Øª $${order.price} Ø¨Ø±Ø§ÛŒ ${coin.name} Ø§Ø¬Ø±Ø§ Ø´Ø¯.`);
          }
        } else if (order.type === 'sell' && newPrice >= order.price) {
          const coinsToSell = order.amount / newPrice;
          if (coin.coinAmount >= coinsToSell) {
            const onePercentSupply = coin.totalSupply * 0.01;
            balance += order.amount;
            coin.coinAmount -= coinsToSell;
            if (coin.coinAmount <= 0) {
              coin.coinAmount = 0;
              coin.avgPrice = 0;
            }
            if (!isPriceFrozen && coinsToSell >= onePercentSupply) {
              const newDumpedPrice = newPrice * 0.95;
              applyPriceChangeForCoin(coinKey, newDumpedPrice); // ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª Ø§Ø±Ø² Ø®Ø§Øµ
              if (coinKey === 'bitcoin') {
                 coins.bitcoin.livePrice = newDumpedPrice;
              }
              alert(`ğŸ“‰ ÙØ±ÙˆØ´ Ø¨Ø²Ø±Ú¯ (${(coinsToSell / coin.totalSupply * 100).toFixed(2)}%) Ø±ÙˆÛŒ ${coin.name}!`);
            } else {
              if (coinKey === currentCoin) {
                updateDisplay();
                updateCoinPercentages(); // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø±ØµØ¯ Ø¨Ø¹Ø¯ Ø§Ø² ÙØ±ÙˆØ´
              }
            }
            limitOrders.splice(i, 1);
            alert(`âœ… Ø§ÙˆØ±Ø¯Ø± ÙØ±ÙˆØ´ Ù„ÛŒÙ…ÛŒØª Ø´Ù…Ø§ Ø¨Ù‡ Ù‚ÛŒÙ…Øª $${order.price} Ø¨Ø±Ø§ÛŒ ${coin.name} Ø§Ø¬Ø±Ø§ Ø´Ø¯.`);
          }
        }
      }
    }
    function applyPriceChangeForCoin(coinKey, newPrice) {
      const coin = coins[coinKey]; // Ø§Ø² Ú©Ù„ÛŒØ¯ Ø§Ø±Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      if (!coin) return; // Ø§Ú¯Ø± Ø§Ø±Ø² ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªØŒ Ø®Ø§Ø±Ø¬ Ø´Ùˆ
      coin.livePrice = newPrice;
      // ÙÙ‚Ø· Ø¢Ù¾Ø¯ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù„Ø§ÛŒÙˆ Ø§ÛŒÙ† Ø§Ø±Ø²
      const liveTf = coin.timeframes.live;
      const timeLabel = liveTf.labels.length ? Number(liveTf.labels[liveTf.labels.length - 1]) + 1 : 1;
      liveTf.labels.push(timeLabel);
      liveTf.priceData.push(newPrice);
      liveTf.barData.push(newPrice - (liveTf.priceData.length > 1 ? liveTf.priceData[liveTf.priceData.length - 2] : newPrice));
      liveTf.rsiData = calculateRSI(liveTf.priceData, rsiPeriod);
      liveTf.smaData = calculateSMA(liveTf.priceData, smaPeriod);
      // Ø¢Ù¾Ø¯ÛŒØª Ø§Ø±Ø²Ø´ ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ† (Ø§Ú¯Ø± Ø§Ø±Ø² Ù¾Ø§ÛŒÙ‡ ØªØºÛŒÛŒØ± Ú©Ù†Ù‡)
      // ØªÙˆØ¬Ù‡: Ø§Ù„Ø§Ù† Ø§ÛŒÙ† ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ† Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒØ´Ù‡ØŒ Ú†ÙˆÙ† ØµÙ†Ø¯ÙˆÙ‚ Ø§ØµÙ„ÛŒ Ù…Ù…Ú©Ù†Ù‡ ÙÙ‚Ø· Ø¨Ù‡ Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ† ÙˆØ§Ø¨Ø³ØªÙ‡ Ø¨Ø§Ø´Ù‡.
      // Ø§Ú¯Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø§Ø±Ø²Ù‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù ÙˆØ§Ø¨Ø³ØªÙ‡ Ø¨Ø§Ø´Ù‡ØŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØºÛŒÛŒØ± Ø¯Ø§Ø±Ù‡.
      if (coinKey === 'bitcoin' && moveCounter > 0) {
        const prevPrice = liveTf.priceData[liveTf.priceData.length - 2] || coin.livePrice;
        const priceChangeFactor = newPrice / prevPrice;
        liquidityPool = liquidityPool * priceChangeFactor;
      }
      // Ø¢Ù¾Ø¯ÛŒØª ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ØªØ± ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø§Ø±Ø²
      updateHigherTimeframesForCoin(coinKey, newPrice);
      // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø­Ø§ÙØ¸Ù‡ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø§Ø±Ø²
      for (let tf of ['live', 'hour1', 'hour4', 'day1', 'week1']) {
        const data = coin.timeframes[tf];
        if (data.labels.length > globalMaxHistory) {
          data.labels.shift(); data.priceData.shift(); data.barData.shift(); data.rsiData.shift(); data.smaData.shift();
        }
      }
      // Ú†Ú© Ú©Ø±Ø¯Ù† Ø§ÙˆØ±Ø¯Ø±Ù‡Ø§ÛŒ Ù„ÛŒÙ…ÛŒØª ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø§Ø±Ø²
      checkLimitOrdersForCoin(coinKey, newPrice);
      // Ú†Ú© Ú©Ø±Ø¯Ù† Ø­Ø¯ Ø¶Ø±Ø± ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø²Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¯Ø± ØµØ±Ø§ÙÛŒ (coins) Ù‡Ø³ØªÙ†Ø¯
      // ÙÙ‚Ø· Ø§Ú¯Ø± Ø§Ø±Ø² ÙØ¹Ù„ÛŒ Ø¨ÙˆØ¯ØŒ Ø­Ø¯ Ø¶Ø±Ø± Ú†Ú© Ø´ÙˆØ¯
      if (coinKey === currentCoin && coin.coinAmount > 0 && newPrice <= coin.stopLossPrice) {
        let coinsToSell = coin.coinAmount;
        balance += coinsToSell * newPrice;
        coin.coinAmount = 0;
        coin.avgPrice = 0;
        updateDisplay();
        updateCoinPercentages(); // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø±ØµØ¯ Ø¨Ø¹Ø¯ Ø§Ø² ÙØ±ÙˆØ´ ØªÙˆØ³Ø· Ø­Ø¯ Ø¶Ø±Ø±
        alert(`Ø­Ø¯ Ø¶Ø±Ø± ÙØ¹Ø§Ù„ Ø´Ø¯. ÙØ±ÙˆØ´ ${coinsToSell.toFixed(4)} Ø³Ù‡Ù… ${coin.name} Ø¨Ù‡ Ù‚ÛŒÙ…Øª $${newPrice.toFixed(2)} Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.`);
      }
      // ÙÙ‚Ø· Ù†Ù…Ø§ÛŒØ´ Ø§Ø±Ø² ÙØ¹Ù„ÛŒ Ø±Ø§ Ø¢Ù¾Ø¯ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      if (coinKey === currentCoin) {
        updateDisplay();
      }
    }
    function updateHigherTimeframesForCoin(coinKey, newLivePrice) {
      const coin = coins[coinKey]; // Ø§Ø² Ú©Ù„ÛŒØ¯ Ø§Ø±Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      // --- 1 Ø³Ø§Ø¹ØªÙ‡: Ù‡Ø± 2 Ø­Ø±Ú©Øª ---
      if (moveCounter % 2 === 0) {
        const tf1h = coin.timeframes.hour1;
        let timeLabel1h = tf1h.labels.length ? tf1h.labels[tf1h.labels.length - 1] + 1 : 1;
        tf1h.labels.push(timeLabel1h);
        tf1h.priceData.push(newLivePrice);
        tf1h.barData.push(newLivePrice - (tf1h.priceData.length > 1 ? tf1h.priceData[tf1h.priceData.length - 2] : newLivePrice));
        tf1h.rsiData = calculateRSI(tf1h.priceData, rsiPeriod);
        tf1h.smaData = calculateSMA(tf1h.priceData, smaPeriod); // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
      }
      // --- 4 Ø³Ø§Ø¹ØªÙ‡: Ù‡Ø± 4 Ø­Ø±Ú©Øª ---
      if (moveCounter % 4 === 0) {
        const tf4h = coin.timeframes.hour4;
        let timeLabel4h = tf4h.labels.length ? tf4h.labels[tf4h.labels.length - 1] + 1 : 1;
        tf4h.labels.push(timeLabel4h);
        tf4h.priceData.push(newLivePrice);
        tf4h.barData.push(newLivePrice - (tf4h.priceData.length > 1 ? tf4h.priceData[tf4h.priceData.length - 2] : newLivePrice));
        tf4h.rsiData = calculateRSI(tf4h.priceData, rsiPeriod);
        tf4h.smaData = calculateSMA(tf4h.priceData, smaPeriod); // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
      }
      // --- Ø±ÙˆØ²Ø§Ù†Ù‡: Ù‡Ø± 5 Ø­Ø±Ú©Øª ---
      if (moveCounter % 5 === 0) {
        const tf1d = coin.timeframes.day1;
        let timeLabel1d = tf1d.labels.length ? tf1d.labels[tf1d.labels.length - 1] + 1 : 1;
        tf1d.labels.push(timeLabel1d);
        tf1d.priceData.push(newLivePrice);
        tf1d.barData.push(newLivePrice - (tf1d.priceData.length > 1 ? tf1d.priceData[tf1d.priceData.length - 2] : newLivePrice));
        tf1d.rsiData = calculateRSI(tf1d.priceData, rsiPeriod);
        tf1d.smaData = calculateSMA(tf1d.priceData, smaPeriod); // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
      }
      // --- Ù‡ÙØªÚ¯ÛŒ: Ù‡Ø± 6 Ø­Ø±Ú©Øª ---
      if (moveCounter % 6 === 0) { // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
        const tf1w = coin.timeframes.week1;
        let timeLabel1w = tf1w.labels.length ? tf1w.labels[tf1w.labels.length - 1] + 1 : 1;
        tf1w.labels.push(timeLabel1w);
        tf1w.priceData.push(newLivePrice);
        tf1w.barData.push(newLivePrice - (tf1w.priceData.length > 1 ? tf1w.priceData[tf1w.priceData.length - 2] : newLivePrice));
        tf1w.rsiData = calculateRSI(tf1w.priceData, rsiPeriod);
        tf1w.smaData = calculateSMA(tf1w.priceData, smaPeriod); // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
      }
    }
    // ========== ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ø·Ø­ Ú©Ø§Ø±Ø¨Ø±ÛŒ ==========
    function getUserLevel(pnlPercent) {
      let level = "ØªØ§Ø²Ù‡ Ú©Ø§Ø±";
      let stars = "â­";
      if (pnlPercent > 200) {
        level = "Ø¬Ø§Ø¯ÙˆÚ¯Ø±";
        stars = "â­â­â­â­â­";
      } else if (pnlPercent > 100) {
        level = "Ø­Ø±ÙÙ‡ Ø§ÛŒ";
        stars = "â­â­â­â­";
      } else if (pnlPercent > 50) {
        level = "Ù¾ÛŒØ´Ø±ÙØªÙ‡";
        stars = "â­â­â­";
      } else if (pnlPercent > 20) {
        level = "Ù…ØªÙˆØ³Ø·";
        stars = "â­â­";
      }
      // Ø§Ú¯Ø± Ø³ÙˆØ¯ Ú©Ù…ØªØ± Ø§Ø² 20% Ø¨ÙˆØ¯ØŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ "ØªØ§Ø²Ù‡ Ú©Ø§Ø± â­" Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…ÙˆÙ†Ù‡
      return { level, stars };
    }
    function updateDisplay() {
      const coin = getCurrentCoinData();
      document.getElementById("balance").innerText = balance.toFixed(2);
      document.getElementById("currentPrice").innerText = coin.livePrice.toFixed(2);
      // --- ØªØºÛŒÛŒØ±: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² price24hAgo Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§Ø±Ø² ÙØ¹Ù„ÛŒ ---
      const change24h = ((coin.livePrice - coin.price24hAgo) / coin.price24hAgo) * 100;
      // --- Ù¾Ø§ÛŒØ§Ù† ØªØºÛŒÛŒØ± ---
      const change24hElement = document.getElementById("priceChange24h");
      change24hElement.innerText = (change24h >= 0 ? '+' : '') + change24h.toFixed(2) + '%';
      change24hElement.style.color = change24h >= 0 ? 'lightgreen' : 'tomato';
      document.getElementById("coinAmount").innerText = coin.coinAmount.toFixed(4);
      document.getElementById("avgPrice").innerText = coin.avgPrice.toFixed(2);
      const assetValue = coin.coinAmount * coin.livePrice;
      document.getElementById("assetValue").innerText = assetValue.toFixed(2);
      const profitLoss = (coin.livePrice - coin.avgPrice) * coin.coinAmount;
      document.getElementById("profitLoss").innerText = profitLoss.toFixed(2);
      document.getElementById("stopLossDisplay").innerText =
        coin.coinAmount > 0 ? coin.stopLossPrice.toFixed(2) : "â€”";
      // --- Ø¨Ø®Ø´ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡: Ú†Ú© Ú©Ø±Ø¯Ù† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø®Ø±ÛŒØ¯ Ø¨Ø§ Ø¯Ø± Ù†Ø¸Ø± Ú¯Ø±ÙØªÙ† Ú©Ù„ Ø³Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡ (ØµÙØ§Ø±ÛŒ + Ú©ÛŒÙ Ù¾ÙˆÙ„) ---
      const totalBoughtByUser = coin.coinAmount + (wallet[currentCoin]?.amount || 0);
      document.getElementById("buyBtn").disabled = (balance <= 0 || totalBoughtByUser >= coin.totalSupply);
      // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ ---
      document.getElementById("sellBtn").disabled = (coin.coinAmount <= 0);
      // Ø¢Ù¾Ø¯ÛŒØª Ù¾Ø±ÙˆÙØ§ÛŒÙ„
      document.getElementById("currentBalanceProfile").innerText = balance.toFixed(2);
      const pnlPercent = ((balance - initialBalance) / initialBalance) * 100;
      const pnlElement = document.getElementById("totalPnLPercent");
      pnlElement.innerText = (pnlPercent >= 0 ? '+' : '') + pnlPercent.toFixed(2) + '%';
      pnlElement.style.color = pnlPercent >= 0 ? 'green' : 'red';
      // --- Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø³Ø·Ø­ Ú©Ø§Ø±Ø¨Ø±ÛŒ ---
      const userLevelInfo = getUserLevel(pnlPercent);
      document.getElementById("userLevel").innerText = userLevelInfo.level;
      document.getElementById("userStars").innerText = userLevelInfo.stars;
      // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ ---
      // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø±ØµØ¯Ù‡Ø§ Ø¯Ø± Ù‡Ø± Ø¨Ø§Ø± ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø§ÛŒÙ† ØªØ§Ø¨Ø¹
      updateCoinPercentages();
      // --- Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ø±Øª Ú©ÛŒÙ Ù¾ÙˆÙ„ ---
      updateWalletDisplay();
      // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ ---
      // --- Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±ØªÙ‚Ø§Ø¡ ---
      updateUpgradeButtons();
      // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ ---
    }
    // ========== ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø±ØµØ¯Ù‡Ø§ Ø¨Ø§ Ø¯Ø± Ù†Ø¸Ø± Ú¯Ø±ÙØªÙ† Ú©ÛŒÙ Ù¾ÙˆÙ„ ==========
    function updateCoinPercentages() {
      const coin = getCurrentCoinData();
      // --- Ø¨Ø®Ø´ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ø±Ø² Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡ (ØµÙØ§Ø±ÛŒ + Ú©ÛŒÙ Ù¾ÙˆÙ„) ---
      const totalBoughtAmount = coin.coinAmount + (wallet[currentCoin]?.amount || 0);
      // ---
      // ØªØºÛŒÛŒØ± Ø§ØµÙ„ÛŒ: Ø¯Ø±ØµØ¯ Ø³Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒâ€ŒØ´Ø¯Ù‡ ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø± (Ú©Ù„ ØµØ±Ø§ÙÛŒ + Ú©ÛŒÙ Ù¾ÙˆÙ„) Ù†Ø³Ø¨Øª Ø¨Ù‡ Ú©Ù„ Ø¹Ø±Ø¶Ù‡
      const percentBought = (totalBoughtAmount / coin.totalSupply) * 100;
      const percentRemaining = 100 - percentBought;
      document.getElementById("percentBought").innerText = percentBought.toFixed(4) + "%";
      document.getElementById("percentRemaining").innerText = percentRemaining.toFixed(4) + "%";
      // Ø¢Ù¾Ø¯ÛŒØª ØµÙ†Ø¯ÙˆÙ‚ Ù†Ù‚Ø¯ÛŒÙ†Ú¯ÛŒ Ø¯Ø± Ú©Ø§Ø±Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª
      document.getElementById("liquidityPoolValue").innerText = liquidityPool.toLocaleString();
    }
    function updateCalendarDisplay(day, month, year) {
      document.getElementById("virtualDayDisplay").innerText = `${day}/${month}/${year}`;
    }
    // ========== ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Ú©ÛŒÙ Ù¾ÙˆÙ„ ==========
    function saveGame() {
      const data = {
        balance,
        virtualDay,
        virtualMonth,
        virtualYear,
        moveCounter,
        coins, // Ø­Ø§Ù„Ø§ Ø´Ø§Ù…Ù„ price24hAgo Ù‡Ø± Ø§Ø±Ø² Ù…ÛŒâ€ŒØ´Ù‡
        currentCoin,
        personalCoinKey,
        isPriceFrozen,
        liquidityPool,
        traderName,
        initialBalance,
        limitOrders,
        wallet, // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¨Ù‡ Ø°Ø®ÛŒØ±Ù‡
        // --- Ø°Ø®ÛŒØ±Ù‡ Ú©Ø±Ø¯Ù† Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ ---
        currentBitcoinDominance,
        lastUpdatedMonth,
        // --- Ø°Ø®ÛŒØ±Ù‡ Ú©Ø±Ø¯Ù† Ø§Ø±ØªÙ‚Ø§Ù‡Ø§ÛŒ Ø§Ø±Ø² Ø´Ø®ØµÛŒ ---
        personalCoinUpgrades: coins[personalCoinKey]?.upgrades || [] // Ø°Ø®ÛŒØ±Ù‡ Ù„ÛŒØ³Øª Ø§Ø±ØªÙ‚Ø§Ù‡Ø§ÛŒ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡
        // --- Ù¾Ø§ÛŒØ§Ù† Ø°Ø®ÛŒØ±Ù‡ ---
      };
      localStorage.setItem("nasrTradingGameSave", JSON.stringify(data));
    }
    // ========== ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Ú©ÛŒÙ Ù¾ÙˆÙ„ ==========
    function loadGame() {
      const saved = localStorage.getItem("nasrTradingGameSave");
      if (saved) {
        const data = JSON.parse(saved);
        balance = data.balance;
        virtualDay = data.virtualDay || 1;
        virtualMonth = data.virtualMonth || 1;
        virtualYear = data.virtualYear || 2022;
        moveCounter = data.moveCounter || 0;
        coins = data.coins;
        currentCoin = data.currentCoin || 'bitcoin';
        personalCoinKey = data.personalCoinKey || null;
        isPriceFrozen = data.isPriceFrozen || false;
        liquidityPool = data.liquidityPool || 100000;
        traderName = data.traderName || "Ù¾Ù„ÛŒØ±";
        initialBalance = data.initialBalance || 1000;
        limitOrders = data.limitOrders || [];
        wallet = data.wallet || {}; // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©ÛŒÙ Ù¾ÙˆÙ„
        // --- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ ---
        currentBitcoinDominance = data.currentBitcoinDominance !== undefined ? data.currentBitcoinDominance : 40;
        lastUpdatedMonth = data.lastUpdatedMonth !== undefined ? data.lastUpdatedMonth : virtualMonth;
        // --- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø±ØªÙ‚Ø§Ù‡Ø§ÛŒ Ø§Ø±Ø² Ø´Ø®ØµÛŒ ---
        if (personalCoinKey && data.personalCoinUpgrades) {
          if (!coins[personalCoinKey]) {
             coins[personalCoinKey] = {
               upgrades: [] // Ø§Ú¯Ø± Ø§Ø±Ø² ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´Øª (Ù…Ø«Ù„Ø§Ù‹ Ø¨Ø¹Ø¯ Ø§Ø² Ø±ÛŒØ³Øª Ø§Ù…Ø§ Ù‚Ø¨Ù„ Ø§Ø² Ø³Ø§Ø®Øª Ù…Ø¬Ø¯Ø¯)ØŒ ÙÙ‚Ø· Ù„ÛŒØ³Øª Ø§Ø±ØªÙ‚Ø§Ù‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø±Ø§ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´
             };
          }
          coins[personalCoinKey].upgrades = data.personalCoinUpgrades; // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ø§Ø±ØªÙ‚Ø§Ù‡Ø§ÛŒ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡
        }
        // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ---
        const freezeBtn = document.getElementById('freezePriceBtn');
        freezeBtn.innerText = isPriceFrozen ? 'â–¶ï¸' : 'â¸ï¸';
        freezeBtn.title = isPriceFrozen ? 'Ù‚ÛŒÙ…Øª ÙØ±ÛŒØ² Ø´Ø¯Ù‡ â€” Ù¾Ø§Ù…Ù¾/Ø¯Ø§Ù…Ù¾ ØºÛŒØ±ÙØ¹Ø§Ù„' : 'ÙØ±ÛŒØ² Ù‚ÛŒÙ…Øª (Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø§Ù…Ù¾/Ø¯Ø§Ù…Ù¾)';
        if (personalCoinKey && coins[personalCoinKey]) {
          document.getElementById("personalCoinTab").innerText = coins[personalCoinKey].name;
          document.getElementById("personalCoinTab").style.display = "inline-block";
        }
        // --- Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù„Ø§Ø³ 'active' Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ø±Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡ Ùˆ Ø¢Ù¾Ø¯ÛŒØª Ù…Ø§Ø±Ú©Øª Ú©Ù¾ ---
        document.querySelectorAll('.coin-tab').forEach(tab => tab.classList.remove('active'));
        if (currentCoin === 'bitcoin') {
          document.getElementById('coinNameTab').classList.add('active');
          const marketCapInMillions = (coins.bitcoin.livePrice * coins.bitcoin.totalSupply) / 1_000_000;
          document.getElementById("marketCap").innerText = formatMarketCap(marketCapInMillions);
          // --- Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ù…ÛŒÙ†Ù†Ø³ Ø¯Ø± Ú©Ø§Ø±Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒØªÚ©ÙˆÛŒÙ† Ø¨Ø¹Ø¯ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ---
          document.getElementById("dominanceDisplay").style.display = 'block';
          document.getElementById("bitcoinDominanceValue").innerText = currentBitcoinDominance.toFixed(2) + "%";
          // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ ---
        } else if (currentCoin === 'ethereum') {
          document.getElementById('coinEthereumTab').classList.add('active');
          const marketCapInMillions = (coins.ethereum.livePrice * coins.ethereum.totalSupply) / 1_000_000;
          document.getElementById("marketCap").innerText = formatMarketCap(marketCapInMillions);
        } else if (currentCoin === 'binance') {
          document.getElementById('coinBinanceTab').classList.add('active');
          const marketCapInMillions = (coins.binance.livePrice * coins.binance.totalSupply) / 1_000_000;
          document.getElementById("marketCap").innerText = formatMarketCap(marketCapInMillions);
        } else if (personalCoinKey && currentCoin === personalCoinKey) {
          document.getElementById('personalCoinTab').classList.add('active');
          const marketCapInMillions = (coins[personalCoinKey].livePrice * coins[personalCoinKey].totalSupply) / 1_000_000;
          document.getElementById("marketCap").innerText = formatMarketCap(marketCapInMillions);
        }
        // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ ---
        // --- Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª ØªØ¨ Ø§Ø±ØªÙ‚Ø§Ø¡ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±ØªÙ‚Ø§Ø¡ Ù¾Ø³ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ---
        updateUpgradeTabStatus();
        updateUpgradeButtons();
        // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ ---
      }
    }
    // ========== ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ ==========
    function transferToWallet() {
      const coin = getCurrentCoinData();
      const percent = parseInt(document.getElementById("tradePercent").value);
      const amountToTransfer = coin.coinAmount * (percent / 100);
      if (amountToTransfer <= 0) {
        alert("Ù…Ù‚Ø¯Ø§Ø± Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² 0 Ø¨Ø§Ø´Ø¯.");
        return;
      }
      if (coin.coinAmount < amountToTransfer) {
        alert("Ù…Ù‚Ø¯Ø§Ø± Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÛŒØ´ØªØ± Ø§Ø² Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ø±Ø² Ø¯Ø± ØµØ±Ø§ÙÛŒ Ø§Ø³Øª.");
        return;
      }
      // Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ø±Ø²
      coin.coinAmount -= amountToTransfer;
      // Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø±Ø² Ø¯Ø± Ú©ÛŒÙ Ù¾ÙˆÙ„
      if (!wallet[currentCoin]) {
        wallet[currentCoin] = { amount: 0, avgPrice: 0 };
      }
      // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‚ÛŒÙ…Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø²Ù‡Ø§ÛŒ Ú©ÛŒÙ Ù¾ÙˆÙ„ (Ø§Ú¯Ø± Ù†ÛŒØ§Ø² Ø¨Ø§Ø´Ù‡)
      // Ø¯Ø± Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ØŒ ÙÙ‚Ø· Ù…Ù‚Ø¯Ø§Ø± Ú©Ù„ Ø§Ù†ØªÙ‚Ø§Ù„ÛŒ Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
      // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‚ÛŒÙ…Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú©ÛŒÙ Ù¾ÙˆÙ„
      const currentWalletAmount = wallet[currentCoin].amount;
      const currentWalletTotalValue = wallet[currentCoin].avgPrice * currentWalletAmount;
      const transferredValue = amountToTransfer * coin.avgPrice; // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² avgPrice ØµØ±Ø§ÙÛŒ
      const newTotalAmount = currentWalletAmount + amountToTransfer;
      const newTotalValue = currentWalletTotalValue + transferredValue;
      wallet[currentCoin].amount = newTotalAmount;
      wallet[currentCoin].avgPrice = newTotalAmount > 0 ? newTotalValue / newTotalAmount : 0;
      // Ø§Ú¯Ø± ØªÙ…Ø§Ù… Ø§Ø±Ø² ÙØ±ÙˆØ®ØªÙ‡ Ø´Ø¯ØŒ Ø­Ø¯ Ø¶Ø±Ø± Ø±Ø§ Ù†ÛŒØ² ØµÙØ± Ú©Ù†
      if (coin.coinAmount <= 0) {
        coin.avgPrice = 0;
        coin.stopLossPrice = 0;
      }
      updateDisplay();
      alert(`âœ… ${amountToTransfer.toFixed(4)} Ø¹Ø¯Ø¯ ${coin.name} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`);
      saveGame();
    }
    // ========== ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ø² Ú©ÛŒÙ Ù¾ÙˆÙ„ ==========
    function transferFromWallet() {
      const coin = getCurrentCoinData();
      const percent = parseInt(document.getElementById("tradePercent").value);
      if (!wallet[currentCoin]) {
        alert(`Ø´Ù…Ø§ Ù‡ÛŒÚ† ${coin.name} Ø¯Ø± Ú©ÛŒÙ Ù¾ÙˆÙ„ Ù†Ø¯Ø§Ø±ÛŒØ¯.`);
        return;
      }
      const amountToTransfer = wallet[currentCoin].amount * (percent / 100);
      if (amountToTransfer <= 0) {
        alert("Ù…Ù‚Ø¯Ø§Ø± Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² 0 Ø¨Ø§Ø´Ø¯.");
        return;
      }
      if (wallet[currentCoin].amount < amountToTransfer) {
        alert("Ù…Ù‚Ø¯Ø§Ø± Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÛŒØ´ØªØ± Ø§Ø² Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ø±Ø² Ø¯Ø± Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø§Ø³Øª.");
        return;
      }
      // Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ø±Ø²
      wallet[currentCoin].amount -= amountToTransfer;
      // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‚ÛŒÙ…Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ØµØ±Ø§ÙÛŒ
      const currentCoinAmount = coin.coinAmount;
      const currentCoinTotalValue = coin.avgPrice * currentCoinAmount;
      const transferredValue = amountToTransfer * wallet[currentCoin].avgPrice; // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² avgPrice Ú©ÛŒÙ Ù¾ÙˆÙ„
      const newTotalAmount = currentCoinAmount + amountToTransfer;
      const newTotalValue = currentCoinTotalValue + transferredValue;
      coin.coinAmount = newTotalAmount;
      coin.avgPrice = newTotalAmount > 0 ? newTotalValue / newTotalAmount : 0;
      // Ø§Ú¯Ø± Ù‚Ø¨Ù„ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ØŒ ØµØ±Ø§ÙÛŒ Ø®Ø§Ù„ÛŒ Ø¨ÙˆØ¯ØŒ Ø­Ø¯ Ø¶Ø±Ø± Ø¬Ø¯ÛŒØ¯ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†
      if (currentCoinAmount <= 0) {
        const stopLossPercent = parseInt(document.getElementById("stopLossPercent").value);
        coin.stopLossPrice = coin.avgPrice * (1 - stopLossPercent / 100);
      }
      // Ø§Ú¯Ø± Ù…Ù‚Ø¯Ø§Ø± Ø§Ø±Ø² Ø¯Ø± Ú©ÛŒÙ Ù¾ÙˆÙ„ ØµÙØ± Ø´Ø¯ØŒ Ú©Ù„ Ú©Ù„ÛŒØ¯ Ø§Ø±Ø² Ø±Ø§ Ø§Ø² Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø­Ø°Ù Ú©Ù†
      if (wallet[currentCoin].amount <= 0) {
        delete wallet[currentCoin];
      }
      updateDisplay();
      alert(`âœ… ${amountToTransfer.toFixed(4)} Ø¹Ø¯Ø¯ ${coin.name} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø² Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¨Ù‡ ØµØ±Ø§ÙÛŒ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`);
      saveGame();
    }
    // ========== ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØªÙˆØ§ÛŒ Ú©ÛŒÙ Ù¾ÙˆÙ„ ==========
    function updateWalletDisplay() {
      const walletList = document.getElementById("walletList");
      walletList.innerHTML = ''; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ù‚Ø¨Ù„ÛŒ
      if (Object.keys(wallet).length === 0) {
        walletList.innerHTML = '<li style="text-align: center; color: gray;">Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª</li>';
        return;
      }
      for (const coinKey in wallet) {
        if (coins[coinKey]) { // Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ Ø§Ø±Ø² ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
          const coinInfo = coins[coinKey];
          const walletAmount = wallet[coinKey].amount;
          const walletAvgPrice = wallet[coinKey].avgPrice;
          const currentValue = walletAmount * coinInfo.livePrice;
          const pnl = (coinInfo.livePrice - walletAvgPrice) * walletAmount;
          const li = document.createElement('li');
          li.innerHTML = `
            <strong>${coinInfo.name}</strong><br>
            ØªØ¹Ø¯Ø§Ø¯: ${walletAmount.toFixed(4)}<br>
            Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†: $${walletAvgPrice.toFixed(2)}<br>
            Ø§Ø±Ø²Ø´ ÙØ¹Ù„ÛŒ: $${currentValue.toFixed(2)}<br>
            Ø³ÙˆØ¯/Ø¶Ø±Ø±: $${pnl.toFixed(2)}
          `;
          walletList.appendChild(li);
        }
      }
    }
    // ========== ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: Ø³ÙˆØ²Ø§Ù†Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¨Ù‡ 1000 Ø¯Ù„Ø§Ø± ==========
    function burnBalanceTo1000() {
      if (balance <= 1000) {
        alert("Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ú©Ù…ØªØ± ÛŒØ§ Ù…Ø³Ø§ÙˆÛŒ 1000 Ø¯Ù„Ø§Ø± Ø§Ø³Øª. Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ Ø³ÙˆØ²Ø§Ù†Ø¯Ù† Ù†ÛŒØ³Øª.");
        return;
      }
      balance = 1000;
      updateDisplay();
      saveGame();
      alert("Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ø¨Ù‡ 1000 Ø¯Ù„Ø§Ø± Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØª! ğŸ’¸ğŸ”¥");
    }
    // ========== RSI Chart ==========
    const rsiCtx = document.getElementById('rsiChart').getContext('2d');
    const rsiChart = new Chart(rsiCtx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'RSI',
          data: [],
          borderColor: 'purple',
          borderWidth: 2,
          fill: false,
          tension: 0.1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: false,
        plugins: {
          annotation: {
            annotations: {
              line70: {
                type: 'line',
                yMin: 70,
                yMax: 70,
                borderColor: 'red',
                borderWidth: 1,
                label: { content: '70', enabled: true, position: 'start' }
              },
              line30: {
                type: 'line',
                yMin: 30,
                yMax: 30,
                borderColor: 'green',
                borderWidth: 1,
                label: { content: '30', enabled: true, position: 'start' }
              }
            }
          }
        },
        scales: {
          y: {
            min: 20,
            max: 80,
            ticks: { stepSize: 30 }
          }
        }
      }
    });
    // ========== Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø± Ø¨Ø§ Ù‡Ù…Ø¨Ø³ØªÚ¯ÛŒ ==========
    function updateChartContent() {
      if (isPriceFrozen) return;
      // --- Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ú†Ú© Ú©Ø±Ø¯Ù† Ù…Ø§Ù‡ Ùˆ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø§Ù…ÛŒÙ†Ù†Ø³ ---
      if (virtualMonth !== lastUpdatedMonth) {
        currentBitcoinDominance = calculateBitcoinDominance(virtualMonth);
        lastUpdatedMonth = virtualMonth;
        // Ø§Ú¯Ø± Ø§Ø±Ø² ÙØ¹Ù„ÛŒ Ø¨ÛŒØªÚ©ÙˆÛŒÙ† Ø§Ø³ØªØŒ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ø±Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª
        if (currentCoin === 'bitcoin') {
          document.getElementById("bitcoinDominanceValue").innerText = currentBitcoinDominance.toFixed(2) + "%";
        }
        console.log(`Ù…Ø§Ù‡ ${virtualMonth} Ø´Ø±ÙˆØ¹ Ø´Ø¯. Ø¯Ø§Ù…ÛŒÙ†Ù†Ø³ Ø¨ÛŒØªÚ©ÙˆÛŒÙ†: ${currentBitcoinDominance}%`);
      }
      // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ ---
      // --- Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ø¬Ø¯ÛŒØ¯ Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ† (Ø§Ø±Ø² Ù¾Ø§ÛŒÙ‡) ---
      const bitcoin = coins.bitcoin;
      let bias = Math.random();
      let changePercent;
      if (bias < 0.53) {
        changePercent = Math.random() * volatilityUp;
      } else {
        changePercent = -Math.random() * volatilityDown;
      }
      let newBitcoinPrice = bitcoin.livePrice * (1 + changePercent);
      newBitcoinPrice = Math.max(newBitcoinPrice, 0.1);
      let cyclicFactor = getCyclicFactor(bitcoin.cycleStep, cycleLength);
      newBitcoinPrice = newBitcoinPrice * cyclicFactor;
      bitcoin.cycleStep++;
      bitcoin.cycleStep = bitcoin.cycleStep % (cycleLength * 2);
      // --- Ø¢Ù¾Ø¯ÛŒØª Ù‚ÛŒÙ…Øª Ù‡Ù…Ù‡ Ø§Ø±Ø²Ù‡Ø§ Ø¨Ø§ Ù‡Ù…Ø¨Ø³ØªÚ¯ÛŒ (ØªØºÛŒÛŒØ± Ø¯Ø±ØµØ¯ÛŒ Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ† + Ù†ÙˆØ³Ø§Ù† Ù…Ø³ØªÙ‚Ù„) ---
      // --- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡Ù…Ø¨Ø³ØªÚ¯ÛŒ Ù¾ÙˆÛŒØ§ ---
      const dynamicCorrelation = calculateCorrelationFromDominance(currentBitcoinDominance);
      const dynamicIndependentFactor = 1 - dynamicCorrelation;
      // --- Ù¾Ø§ÛŒØ§Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡Ù…Ø¨Ø³ØªÚ¯ÛŒ Ù¾ÙˆÛŒØ§ ---
      for (const key in coins) {
        const coin = coins[key];
        let independentBias = Math.random();
        let independentChangePercent;
        if (independentBias < 0.5) {
          independentChangePercent = Math.random() * independentVolatility;
        } else {
          independentChangePercent = -Math.random() * independentVolatility;
        }
        // Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØºÛŒÛŒØ± Ù†Ù‡Ø§ÛŒÛŒ: (ØªØºÛŒÛŒØ± Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ† * Ø¶Ø±ÛŒØ¨ Ù‡Ù…Ø¨Ø³ØªÚ¯ÛŒ) + (ØªØºÛŒÛŒØ± Ù…Ø³ØªÙ‚Ù„ * Ø¶Ø±ÛŒØ¨ Ù…Ø³ØªÙ‚Ù„)
        let finalChangePercent = (changePercent * dynamicCorrelation) + (independentChangePercent * dynamicIndependentFactor);
        let newPrice = coin.livePrice * (1 + finalChangePercent);
        newPrice = Math.max(newPrice, 0.1); // Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø­Ø¯Ø§Ù‚Ù„ Ù‚ÛŒÙ…Øª
        // Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ±Ø§Øª ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø§Ø±Ø²
        applyPriceChangeForCoin(key, newPrice);
      }
      moveCounter++;
      if (moveCounter >= 30) {
        virtualDay++;
        moveCounter = 0;
        if (virtualDay > 30) {
          virtualDay = 1;
          virtualMonth++;
          if (virtualMonth > 12) {
            virtualMonth = 1;
            virtualYear++;
          }
        }
        updateCalendarDisplay(virtualDay, virtualMonth, virtualYear);
        // --- ØªØºÛŒÛŒØ±: Ø¢Ù¾Ø¯ÛŒØª price24hAgo ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ† ---
        coins.bitcoin.price24hAgo = coins.bitcoin.livePrice;
        // --- Ù¾Ø§ÛŒØ§Ù† ØªØºÛŒÛŒØ± ---
        const marketCapInMillions = (coins.bitcoin.livePrice * coins.bitcoin.totalSupply) / 1_000_000;
        document.getElementById("marketCap").innerText = formatMarketCap(marketCapInMillions);
      }
      // --- Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ú†Ú© Ú©Ø±Ø¯Ù† RSI Ùˆ Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª Ø±ÙˆÛŒ Ù‡Ù…Ù‡ Ø§Ø±Ø²Ù‡Ø§ ---
      if (!isPriceFrozen) { // ÙÙ‚Ø· Ø§Ú¯Ø± Ù‚ÛŒÙ…Øª ÙØ±ÛŒØ² Ù†Ø¨Ø§Ø´Ù‡
        for (const coinKey in coins) {
          const coin = coins[coinKey];
          const activeTfData = coin.timeframes[currentConfig.timeframe];
          const rsiLength = activeTfData.rsiData.length;
          if (rsiLength > 0) {
            // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¢Ø®Ø±ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± RSI Ú©Ù‡ null Ù†Ø¨Ø§Ø´Ù‡
            let lastRsiValue = null;
            for (let i = rsiLength - 1; i >= 0; i--) {
              if (activeTfData.rsiData[i] !== null) {
                lastRsiValue = parseFloat(activeTfData.rsiData[i]);
                break;
              }
            }
            if (lastRsiValue !== null) {
              let newPriceForPumpDump = coin.livePrice;
              let message = '';
              if (lastRsiValue <= 20) {
                // Ù¾Ø§Ù…Ù¾ 2 Ø¯Ø±ØµØ¯ÛŒ
                newPriceForPumpDump = coin.livePrice * 1.02;
                message = `ğŸ“ˆ RSI ${coin.name} Ø¨Ù‡ ${lastRsiValue.toFixed(2)} Ø±Ø³ÛŒØ¯! Ù¾Ø§Ù…Ù¾ 2% Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯.`;
              } else if (lastRsiValue >= 80) {
                // Ø¯Ø§Ù…Ù¾ 2 Ø¯Ø±ØµØ¯ÛŒ
                newPriceForPumpDump = coin.livePrice * 0.98;
                message = `ğŸ“‰ RSI ${coin.name} Ø¨Ù‡ ${lastRsiValue.toFixed(2)} Ø±Ø³ÛŒØ¯! Ø¯Ø§Ù…Ù¾ 2% Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯.`;
              }
              // Ø§Ú¯Ø± ØªØºÛŒÛŒØ±ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯ (RSI Ø¯Ø± Ø¨Ø§Ø²Ù‡ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø¨ÙˆØ¯)
              if (newPriceForPumpDump !== coin.livePrice) {
                // Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø­Ø¯Ø§Ù‚Ù„ Ù‚ÛŒÙ…Øª
                newPriceForPumpDump = Math.max(newPriceForPumpDump, 0.1);
                // Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª Ø±ÙˆÛŒ Ø§Ø±Ø² ÙØ¹Ù„ÛŒ
                applyPriceChangeForCoin(coinKey, newPriceForPumpDump);
                console.log(message); // Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¨Ø§Ú¯ØŒ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø­Ø°ÙØ´ Ú©Ù†ÛŒ
                // alert(message); // Ø§Ú¯Ø± Ø¨Ø®ÙˆØ§ÛŒ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ù†Ø´ÙˆÙ† Ø¨Ø¯ÛŒØŒ Ø§ÛŒÙ† Ø®Ø· ÙØ¹Ø§Ù„ Ú©Ù†ØŒ ÙˆÙ„ÛŒ Ù…Ù…Ú©Ù†Ù‡ Ø¢Ø²Ø§Ø±Ø¯Ù‡Ù†Ø¯Ù‡ Ø¨Ø§Ø´Ù‡
              }
            }
          }
        }
      }
      // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ ---
      // Ø§Ú¯Ø± Ø§Ø±Ø² ÙØ¹Ù„ÛŒ ÙØ±ÛŒØ² Ù†Ø¨ÙˆØ¯ØŒ Ù†Ù…Ø§ÛŒØ´ Ùˆ Ù†Ù…ÙˆØ¯Ø§Ø± Ø±Ùˆ Ø¢Ù¾Ø¯ÛŒØª Ú©Ù†
      // Ø§ÛŒÙ† Ø¨Ø®Ø´ ÙÙ‚Ø· Ø§Ú¯Ø± Ø§Ø±Ø² ÙØ¹Ù„ÛŒ ÙØ±ÛŒØ² Ù†Ø¨Ø§Ø´Ù‡ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´Ù‡ØŒ Ø§Ù…Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ø±ÙˆØ² Ù…ÛŒâ€ŒØ´Ù†
      if (!isPriceFrozen) {
        updateDisplay();
        updatePriceChart();
        const activeTfData = getCurrentCoinData().timeframes[currentConfig.timeframe];
        rsiChart.data.labels = activeTfData.labels.slice(-currentConfig.maxPoints);
        rsiChart.data.datasets[0].data = activeTfData.rsiData.slice(-currentConfig.maxPoints);
        rsiChart.update();
        // Ø¢Ù¾Ø¯ÛŒØª Ø®Ø· SMA Ø¯Ø± Ù†Ù…ÙˆØ¯Ø§Ø± ÙØ¹Ø§Ù„
        const coin = getCurrentCoinData();
        const tfData = coin.timeframes[currentConfig.timeframe];
        let smaData = tfData.priceData.map((price, i) => ({
          time: Math.floor(Date.now() / 1000) - (tfData.priceData.length - i) * 60,
          value: tfData.smaData[i]
        }));
        const filteredSmaData = smaData.filter(item => item.value !== null);
        if (filteredSmaData.length > 0) {
          smaSeries.setData(filteredSmaData.slice(-currentConfig.maxPoints));
        } else {
          smaSeries.setData([]);
        }
      }
    }
    function setTimeFrame(frame) {
      if (currentIntervalId) clearInterval(currentIntervalId);
      currentConfig = timeFrameConfigs[frame];
      updatePriceChart();
      const coin = getCurrentCoinData();
      const tfData = coin.timeframes[frame];
      rsiChart.data.labels = tfData.labels.slice(-currentConfig.maxPoints);
      rsiChart.data.datasets[0].data = tfData.rsiData.slice(-currentConfig.maxPoints);
      rsiChart.update();
      currentIntervalId = setInterval(updateChartContent, currentConfig.interval);
    }
    function createMyCoin() {
      const name = document.getElementById("coinNameInput").value.trim();
      const supply = parseFloat(document.getElementById("totalSupplyInput").value);
      const price = parseFloat(document.getElementById("listingPriceInput").value);
      const network = document.getElementById("networkSelect").value; // Ø®ÙˆØ§Ù†Ø¯Ù† Ø´Ø¨Ú©Ù‡
      if (!name || name.length < 2) {
        alert("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø§Ø±Ø² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ø­Ø¯Ø§Ù‚Ù„ 2 Ú©Ø§Ø±Ø§Ú©ØªØ±).");
        return;
      }
      if (isNaN(supply) || supply < 1000) {
        alert("ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø³Ú©Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ 1000 Ø¨Ø§Ø´Ø¯.");
        return;
      }
      if (isNaN(price) || price <= 0) {
        alert("Ù‚ÛŒÙ…Øª Ù„ÛŒØ³Øª Ø´Ø¯Ù† Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² 0 Ø¨Ø§Ø´Ø¯.");
        return;
      }
      if (balance < 100) {
        alert("Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª Ø§Ø±Ø² Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª! Ù†ÛŒØ§Ø² Ø¨Ù‡ 100 Ø¯Ù„Ø§Ø± Ø¯Ø§Ø±ÛŒØ¯.");
        return;
      }
      personalCoinKey = 'mycoin_' + Date.now();
      const myCoins = supply * 0.8; // ØªØºÛŒÛŒØ± Ø§Ø² 0.2 Ø¨Ù‡ 0.8
      const freeSupply = supply - myCoins; // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù‡Ù… Ø¢Ø²Ø§Ø¯ (20%)
      coins[personalCoinKey] = {
        name: name,
        totalSupply: supply,
        livePrice: price,
        coinAmount: myCoins, // ÙÙ‚Ø· Ø³Ù‡Ù… Ø³Ø§Ø²Ù†Ø¯Ù‡
        avgPrice: price,
        stopLossPrice: price * (1 - 5/100),
        price24hAgo: price, // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ - Ù…Ù‚Ø¯Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡ Ù‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ
        cycleStep: 0,
        timeframes: {
          live: createInitialTimeframeData(price),
          hour1: createInitialTimeframeData(price),
          hour4: createInitialTimeframeData(price),
          day1: createInitialTimeframeData(price),
          week1: createInitialTimeframeData(price) // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
        },
        upgrades: [] // Ø´Ø±ÙˆØ¹ Ø¨Ø§ Ù„ÛŒØ³Øª Ø®Ø§Ù„ÛŒ Ø§Ø±ØªÙ‚Ø§Ù‡Ø§ÛŒ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡
      };
      balance -= 100;
      document.getElementById("personalCoinTab").innerText = name;
      document.getElementById("personalCoinTab").style.display = "inline-block";
      switchToCoin(personalCoinKey);
      const marketCapInMillions = (price * supply) / 1_000_000;
      document.getElementById("marketCap").innerText = formatMarketCap(marketCapInMillions);
      // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ÙØ±Ù…Øª Ø¹Ø±Ø¶Ù‡ Ú©Ù„
      document.getElementById("totalSupplyDisplay").innerText = formatTotalSupply(supply);
      // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø±ØµØ¯Ù‡Ø§ Ø¨Ø¹Ø¯ Ø§Ø² Ø³Ø§Ø®Øª Ø§Ø±Ø² Ø¬Ø¯ÛŒØ¯
      updateCoinPercentages();
      // --- Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª ØªØ¨ Ø§Ø±ØªÙ‚Ø§Ø¡ Ø¨Ø¹Ø¯ Ø§Ø² Ø³Ø§Ø®Øª Ø§Ø±Ø² ---
      updateUpgradeTabStatus();
      updateUpgradeButtons();
      // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ ---
      alert(`ğŸ‰ Ø§Ø±Ø² "${name}" Ø¨Ø± Ø±ÙˆÛŒ Ø´Ø¨Ú©Ù‡ "${network}" Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯!
80% (${formatTotalSupply(myCoins)} Ø³Ú©Ù‡) Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.
20% (${formatTotalSupply(freeSupply)} Ø³Ú©Ù‡) Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´ Ø¯Ø± Ø¨Ø§Ø²Ø§Ø± Ø¢Ø²Ø§Ø¯ Ù‚Ø±Ø§Ø± Ú¯Ø±ÙØª.`);
      document.getElementById("myCoinForm").style.display = "none";
    }
    // ========== ØªÙˆØ§Ø¨Ø¹ ØµÙ†Ø¯ÙˆÙ‚ Ù†Ù‚Ø¯ÛŒÙ†Ú¯ÛŒ ==========
    function depositToPool(amount) {
      if (balance < amount) {
        alert("Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ ÙˆØ§Ø±ÛŒØ² Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª!");
        return;
      }
      balance -= amount;
      liquidityPool += amount;
      updateDisplay();
      updateCoinPercentages();
      saveGame();
    }
    function withdrawFromPool(amount) {
      if (liquidityPool < amount) {
        alert("Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª!");
        return;
      }
      balance += amount;
      liquidityPool -= amount;
      updateDisplay();
      updateCoinPercentages();
      saveGame();
    }
    // ========== ØªÙˆØ§Ø¨Ø¹ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§Ø±ØªÙ‚Ø§Ø¡ ==========
    // --- ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª ØªØ¨ Ø§Ø±ØªÙ‚Ø§Ø¡ ---
    function updateUpgradeTabStatus() {
      const upgradeTab = document.getElementById('upgradeTab');
      // Ø­Ø°Ù event listener Ù‚Ø¨Ù„ÛŒØŒ ØµØ±Ù Ù†Ø¸Ø± Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù‡ ÛŒØ§ Ù†Ù‡
      upgradeTab.onclick = null;

      if (currentCoin === personalCoinKey) {
        upgradeTab.classList.remove('upgrade-tab-inactive');
        upgradeTab.style.opacity = '1';
        upgradeTab.style.cursor = 'pointer';
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† event listener ÙÙ‚Ø· Ø§Ú¯Ø± Ø§Ø±Ø² Ø´Ø®ØµÛŒ Ø¨Ø§Ø´Ø¯
        upgradeTab.onclick = showUpgradeCard;
      } else {
        upgradeTab.classList.add('upgrade-tab-inactive');
        upgradeTab.style.opacity = '0.5';
        upgradeTab.style.cursor = 'not-allowed';
        // ØªØ£ÛŒÛŒØ¯ Ú©Ù‡ event listener Ø­Ø°Ù Ø´Ø¯Ù‡ Ø§Ø³Øª
      }
    }
    // --- ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ø±Øª Ø§Ø±ØªÙ‚Ø§Ø¡ ---
    function showUpgradeCard() {
      const upgradeCard = document.getElementById('upgradeCard');
      if (upgradeCard.style.display === 'none') {
        upgradeCard.style.display = 'block';
        showOverlay();
      } else {
        upgradeCard.style.display = 'none';
        hideOverlay();
      }
    }
    // --- ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±ØªÙ‚Ø§Ø¡ ---
    function updateUpgradeButtons() {
      if (currentCoin !== personalCoinKey) return; // ÙÙ‚Ø· Ø§Ú¯Ø± Ø§Ø±Ø² Ø´Ø®ØµÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯

      const coin = getCurrentCoinData();
      const upgrades = coin.upgrades || []; // Ø§Ú¯Ø± Ø§Ø±ØªÙ‚Ø§Ù‡Ø§ÛŒÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªØŒ Ù„ÛŒØ³Øª Ø®Ø§Ù„ÛŒ

      const upgradeButtons = {
        'upgradeTpsBtn': 'TPS',
        'upgradeSecurityBtn': 'Security',
        'upgradeConsensusBtn': 'Consensus',
        'upgradeNftBtn': 'NFT',
        'upgradeMarketingBtn': 'Marketing'
      };

      for (const [buttonId, upgradeName] of Object.entries(upgradeButtons)) {
        const button = document.getElementById(buttonId);
        if (button) {
          if (upgrades.includes(upgradeName)) {
            // Ø§Ø±ØªÙ‚Ø§Ø¡ Ù‚Ø¨Ù„Ø§Ù‹ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡
            button.disabled = true;
            button.textContent = 'âœ…';
          } else {
            // Ø§Ø±ØªÙ‚Ø§Ø¡ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯
            button.disabled = false;
            button.textContent = 'Ø®Ø±ÛŒØ¯';
          }
        }
      }
    }
    // --- ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: Ø®Ø±ÛŒØ¯ Ø§Ø±ØªÙ‚Ø§Ø¡ ---
    function purchaseUpgrade(upgradeName) {
      if (currentCoin !== personalCoinKey) {
        alert("Ø§Ø¨ØªØ¯Ø§ Ø§Ø±Ø² Ø´Ø®ØµÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");
        return;
      }
      if (balance < 1000) {
        alert("Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø§ÛŒÙ† Ø§Ø±ØªÙ‚Ø§Ø¡ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª! Ù†ÛŒØ§Ø² Ø¨Ù‡ 1000 Ø¯Ù„Ø§Ø± Ø¯Ø§Ø±ÛŒØ¯.");
        return;
      }

      const coin = getCurrentCoinData();
      if (!coin.upgrades) {
        coin.upgrades = [];
      }

      if (coin.upgrades.includes(upgradeName)) {
        alert("Ø§ÛŒÙ† Ø§Ø±ØªÙ‚Ø§Ø¡ Ù‚Ø¨Ù„Ø§Ù‹ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.");
        return;
      }

      balance -= 1000;
      coin.upgrades.push(upgradeName); // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ø±ØªÙ‚Ø§Ø¡ Ø¨Ù‡ Ù„ÛŒØ³Øª

      // Ù¾Ø§Ù…Ù¾ 5% Ù‚ÛŒÙ…Øª
      coin.livePrice *= 1.05;
      // Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª Ø¨Ù‡ ØªÙ…Ø§Ù… ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…â€ŒÙ‡Ø§
      for (let tf of ['live', 'hour1', 'hour4', 'day1', 'week1']) {
        const data = coin.timeframes[tf];
        if (data.priceData.length > 0) {
          data.priceData[data.priceData.length - 1] = coin.livePrice;
          data.rsiData = calculateRSI(data.priceData, rsiPeriod);
          data.smaData = calculateSMA(data.priceData, smaPeriod);
        }
      }
      // Ø¢Ù¾Ø¯ÛŒØª Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ Ùˆ Ù†Ù…Ø§ÛŒØ´
      updateDisplay();
      updatePriceChart();
      const activeTfData = coin.timeframes[currentConfig.timeframe];
      rsiChart.data.labels = activeTfData.labels.slice(-currentConfig.maxPoints);
      rsiChart.data.datasets[0].data = activeTfData.rsiData.slice(-currentConfig.maxPoints);
      rsiChart.update();

      alert(`ğŸ‰ Ø§Ø±ØªÙ‚Ø§Ø¡ "${upgradeName}" Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯! Ù‚ÛŒÙ…Øª Ø§Ø±Ø² Ø´Ù…Ø§ 5% Ù¾Ø§Ù…Ù¾ Ø´Ø¯.`);
      saveGame();
    }
    // ========== Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ ==========
    document.querySelectorAll('.timeframe-tab').forEach(tab => {
      tab.addEventListener('click', function() {
        const frame = this.getAttribute('data-frame');
        if (!frame) return;
        // Ø§ÙˆÙ„ ØªØ§ÛŒÙ… ÙØ±ÛŒÙ… Ø±Ùˆ ØªØºÛŒÛŒØ± Ø¨Ø¯Ù‡
        setTimeFrame(frame);
        // Ø¨Ø¹Ø¯ Ú©Ù„Ø§Ø³ active Ø±Ùˆ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù†
        document.querySelectorAll('.timeframe-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
      });
    });
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±ÙˆÛŒØ¯Ø§Ø¯ Ú©Ù„ÛŒÚ© Ø¨Ø±Ø§ÛŒ ØªØ¨â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø²Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
    document.getElementById('coinNameTab').addEventListener('click', () => {
      switchToCoin('bitcoin');
    });
    document.getElementById('coinEthereumTab').addEventListener('click', () => {
      switchToCoin('ethereum');
    });
    document.getElementById('coinBinanceTab').addEventListener('click', () => {
      switchToCoin('binance');
    });
    document.getElementById('personalCoinTab').addEventListener('click', () => {
      if (personalCoinKey && coins[personalCoinKey]) {
        switchToCoin(personalCoinKey);
      }
    });
    document.getElementById('secretTab').addEventListener('click', function() {
      const form = document.getElementById('secretForm');
      form.style.display = (form.style.display === 'none') ? 'block' : 'none';
    });
    document.getElementById('orderType').addEventListener('change', function() {
      const limitInput = document.getElementById('limitPriceInput');
      if (this.value === 'limit') {
        limitInput.style.display = 'block';
      } else {
        limitInput.style.display = 'none';
      }
    });
    document.getElementById("buyBtn").addEventListener("click", function() {
      const coin = getCurrentCoinData();
      const orderType = document.getElementById("orderType").value;
      const percent = parseInt(document.getElementById("tradePercent").value);
      const amountToSpend = balance * (percent / 100);
      if (orderType === 'market') {
        // --- Ø¨Ø®Ø´ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡: Ú†Ú© Ú©Ø±Ø¯Ù† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ú©Ù„ Ø³Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡ (ØµÙØ§Ø±ÛŒ + Ú©ÛŒÙ Ù¾ÙˆÙ„) Ù‚Ø¨Ù„ Ø§Ø² Ø®Ø±ÛŒØ¯ ---
        const totalBoughtByUser = coin.coinAmount + (wallet[currentCoin]?.amount || 0);
        if (balance <= 0 || totalBoughtByUser >= coin.totalSupply) {
          if (totalBoughtByUser >= coin.totalSupply) {
            alert("âŒ ØªÙ…Ø§Ù… Ø³Ú©Ù‡â€ŒÙ‡Ø§ ØªÙˆØ³Ø· Ø´Ù…Ø§ (Ø¯Ø± ØµØ±Ø§ÙÛŒ ÛŒØ§ Ú©ÛŒÙ Ù¾ÙˆÙ„) Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯! Ø¯ÛŒÚ¯Ø± Ø§Ù…Ú©Ø§Ù† Ø®Ø±ÛŒØ¯ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.");
          }
          return; // Ø®Ø§Ø±Ø¬ Ø´Ùˆ Ø§Ú¯Ø± Ø´Ø±Ø§ÛŒØ· Ø¨Ø±Ù‚Ø±Ø§Ø± Ø¨ÙˆØ¯
        }
        // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ ---
        const coinsBought = amountToSpend / coin.livePrice;
        // Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§ÛŒØ¯ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø¬Ø¯ÛŒØ¯ Ø±Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒÙ…: Ø¢ÛŒØ§ Ù…Ø¬Ù…ÙˆØ¹ Ø³Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ + Ø³Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ (ØµÙØ§Ø±ÛŒ + Ú©ÛŒÙ Ù¾ÙˆÙ„) Ø¨ÛŒØ´ØªØ± Ø§Ø² Ú©Ù„ Ø¹Ø±Ø¶Ù‡ Ù†Ù…ÛŒØ´Ù‡ØŸ
        const maxCoinsAllowedBySupply = coin.totalSupply - (coin.coinAmount + (wallet[currentCoin]?.amount || 0)); // Ù…Ù‚Ø¯Ø§Ø±ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒÙ… Ø­Ø¯Ø§Ú©Ø«Ø± Ø¨Ø®Ø±ÛŒÙ…
        if (coinsBought > maxCoinsAllowedBySupply) {
          if (maxCoinsAllowedBySupply <= 0) {
            // Ø§ÛŒÙ† Ø¨Ø§ÛŒØ¯ Ø§Ø² Ú†Ú© Ø§ÙˆÙ„ Ú¯Ø°Ø´ØªÙ‡ Ø¨Ø§Ø´Ù‡ØŒ Ø§Ù…Ø§ Ø§Ú¯Ø± Ø§ØªÙØ§Ù‚ÛŒ Ø§ÛŒÙ†Ø¬Ø§ Ø±Ø³ÛŒØ¯ØŒ Ù‡Ù†ÙˆØ² 0 ÛŒØ§ Ú©Ù…ØªØ± Ù…Ø¬Ø§Ø²Ù‡
            alert("âŒ ØªÙ…Ø§Ù… Ø³Ú©Ù‡â€ŒÙ‡Ø§ ØªÙˆØ³Ø· Ø´Ù…Ø§ (Ø¯Ø± ØµØ±Ø§ÙÛŒ ÛŒØ§ Ú©ÛŒÙ Ù¾ÙˆÙ„) Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯! Ø¯ÛŒÚ¯Ø± Ø§Ù…Ú©Ø§Ù† Ø®Ø±ÛŒØ¯ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.");
            return;
          }
          // ÙÙ‚Ø· Ù…Ù‚Ø¯Ø§Ø± Ù…Ø¬Ø§Ø² Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´ÙˆØ¯
          const newAmount = maxCoinsAllowedBySupply * coin.livePrice;
          balance -= newAmount;
          coin.coinAmount += maxCoinsAllowedBySupply;
          coin.avgPrice = coin.coinAmount > 0
            ? ((coin.avgPrice * (coin.coinAmount - maxCoinsAllowedBySupply)) + (coin.livePrice * maxCoinsAllowedBySupply)) / coin.coinAmount
            : coin.livePrice;
          alert(`âš ï¸ ÙÙ‚Ø· ${maxCoinsAllowedBySupply.toFixed(4)} Ø³Ú©Ù‡ Ø¯ÛŒÚ¯Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø®Ø±ÛŒØ¯ (Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ø³Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ú©ÛŒÙ Ù¾ÙˆÙ„). Ø®Ø±ÛŒØ¯ Ø¨Ù‡ Ø§ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ù…Ø­Ø¯ÙˆØ¯ Ø´Ø¯.`);
        } else {
          // Ø®Ø±ÛŒØ¯ Ù…Ø¹Ù…ÙˆÙ„ÛŒ
          balance -= amountToSpend;
          coin.coinAmount += coinsBought;
          coin.avgPrice = coin.coinAmount > 0
            ? ((coin.avgPrice * (coin.coinAmount - coinsBought)) + (coin.livePrice * coinsBought)) / coin.coinAmount
            : coin.livePrice;
        }
        const stopLossPercent = parseInt(document.getElementById("stopLossPercent").value);
        coin.stopLossPrice = coin.avgPrice * (1 - stopLossPercent / 100);
        const onePercentSupply = coin.totalSupply * 0.01;
        if (!isPriceFrozen && coinsBought >= onePercentSupply) {
          const newPrice = coin.livePrice * 1.05;
          applyPriceChangeForCoin(currentCoin, newPrice);
          if (currentCoin === 'bitcoin') {
             coins.bitcoin.livePrice = newPrice;
          }
          alert(`ğŸ”¥ Ù¾Ø§Ù…Ù¾! Ø®Ø±ÛŒØ¯ Ø¨Ø²Ø±Ú¯ (${(coinsBought / coin.totalSupply * 100).toFixed(2)}%) Ø¨Ø§Ø¹Ø« Ø±Ø´Ø¯ 5% Ù‚ÛŒÙ…Øª Ø´Ø¯!`);
        } else {
          updateDisplay();
          // updateCoinPercentages(); // Ø§ÛŒÙ†Ø¬Ø§ Ù†ÛŒØ§Ø² Ù†ÛŒØ³Øª Ú†ÙˆÙ† updateDisplay Ø§ÛŒÙ† Ú©Ø§Ø± Ø±Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
        }
      } else if (orderType === 'limit') {
        const limitPrice = parseFloat(document.getElementById("limitPrice").value);
        if (isNaN(limitPrice) || limitPrice <= 0) {
          alert("Ù„Ø·ÙØ§Ù‹ Ù‚ÛŒÙ…Øª Ù„ÛŒÙ…ÛŒØª Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
          return;
        }
        limitOrders.push({
          type: 'buy',
          price: limitPrice,
          amount: amountToSpend,
          coinKey: currentCoin
        });
        alert(`âœ… Ø§ÙˆØ±Ø¯Ø± Ø®Ø±ÛŒØ¯ Ù„ÛŒÙ…ÛŒØª Ø¨Ù‡ Ù‚ÛŒÙ…Øª $${limitPrice} Ø«Ø¨Øª Ø´Ø¯.`);
      }
      saveGame();
    });
    document.getElementById("sellBtn").addEventListener("click", function() {
      const coin = getCurrentCoinData();
      const orderType = document.getElementById("orderType").value;
      const percent = parseInt(document.getElementById("tradePercent").value);
      const coinsToSell = coin.coinAmount * (percent / 100);
      if (orderType === 'market') {
        if (coin.coinAmount <= 0) return;
        const onePercentSupply = coin.totalSupply * 0.01;
        if (!isPriceFrozen && coinsToSell >= onePercentSupply) {
          balance += coinsToSell * coin.livePrice;
          coin.coinAmount -= coinsToSell;
          if (coin.coinAmount <= 0) {
            coin.coinAmount = 0;
            coin.avgPrice = 0;
          }
          const newPrice = coin.livePrice * 0.95;
          applyPriceChangeForCoin(currentCoin, newPrice);
          if (currentCoin === 'bitcoin') {
             coins.bitcoin.livePrice = newPrice;
          }
          alert(`ğŸ“‰ Ø¯Ø§Ù…Ù¾! ÙØ±ÙˆØ´ Ø¨Ø²Ø±Ú¯ (${(coinsToSell / coin.totalSupply * 100).toFixed(2)}%) Ø¨Ø§Ø¹Ø« Ø³Ù‚ÙˆØ· 5% Ù‚ÛŒÙ…Øª Ø´Ø¯!`);
        } else {
          balance += coinsToSell * coin.livePrice;
          coin.coinAmount -= coinsToSell;
          if (coin.coinAmount <= 0) {
            coin.coinAmount = 0;
            coin.avgPrice = 0;
          }
          updateDisplay();
          // updateCoinPercentages(); // Ø§ÛŒÙ†Ø¬Ø§ Ù†ÛŒØ§Ø² Ù†ÛŒØ³Øª Ú†ÙˆÙ† updateDisplay Ø§ÛŒÙ† Ú©Ø§Ø± Ø±Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
        }
      } else if (orderType === 'limit') {
        const limitPrice = parseFloat(document.getElementById("limitPrice").value);
        if (isNaN(limitPrice) || limitPrice <= 0) {
          alert("Ù„Ø·ÙØ§Ù‹ Ù‚ÛŒÙ…Øª Ù„ÛŒÙ…ÛŒØª Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
          return;
        }
        const amountToSell = coinsToSell * coin.livePrice;
        limitOrders.push({
          type: 'sell',
          price: limitPrice,
          amount: amountToSell,
          coinKey: currentCoin
        });
        alert(`âœ… Ø§ÙˆØ±Ø¯Ø± ÙØ±ÙˆØ´ Ù„ÛŒÙ…ÛŒØª Ø¨Ù‡ Ù‚ÛŒÙ…Øª $${limitPrice} Ø«Ø¨Øª Ø´Ø¯.`);
      }
      saveGame();
    });
    document.getElementById('applySecret').addEventListener('click', function() {
      const code = document.getElementById('secretCode').value.trim();
      const amount = parseFloat(document.getElementById('secretAmount').value);
      if (code.toLowerCase() === 'Ù…Ù‡Ø±Ø§Ù†' && !isNaN(amount) && amount > 0) {
        balance += amount;
        updateDisplay();
        alert(`ØªØ¨Ø±ÛŒÚ©! ${amount} Ø¯Ù„Ø§Ø± Ø¨Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ ğŸ’°`);
        document.getElementById('secretCode').value = '';
        document.getElementById('secretAmount').value = '';
        document.getElementById('secretForm').style.display = 'none';
      } else {
        alert('Ú©Ø¯ ÛŒØ§ Ù…Ù‚Ø¯Ø§Ø± ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø§Ø´ØªØ¨Ø§Ù‡Ù‡ ğŸ˜•');
      }
    });
    document.getElementById("resetBtn").addEventListener("click", () => {
      if (confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø§Ø²ÛŒ Ø±Ø§ Ø±ÛŒØ³Øª Ú©Ù†ÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª.")) {
        localStorage.removeItem("nasrTradingGameSave");
        balance = 1000;
        virtualDay = 1;
        virtualMonth = 1;
        virtualYear = 2022;
        moveCounter = 0;
        isPriceFrozen = false;
        liquidityPool = 100000;
        traderName = "Ù¾Ù„ÛŒØ±";
        initialBalance = 1000;
        limitOrders = [];
        // --- Ø±ÛŒØ³Øª Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ ---
        currentBitcoinDominance = 40; // Ø´Ø±ÙˆØ¹ Ø¨Ø§ 40%
        lastUpdatedMonth = virtualMonth; // Ø°Ø®ÛŒØ±Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ù…Ø§Ù‡ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
        // --- Ù¾Ø§ÛŒØ§Ù† Ø±ÛŒØ³Øª ---
        coins = {
          bitcoin: {
            name: "Ø¨ÛŒØªÚ©ÙˆÛŒÙ†",
            totalSupply: 21000000,
            livePrice: 16000, // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
            coinAmount: 0,
            avgPrice: 0,
            stopLossPrice: 0,
            price24hAgo: 16000, // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
            cycleStep: 0,
            timeframes: {
              live: createInitialTimeframeData(16000), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
              hour1: createInitialTimeframeData(16000), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
              hour4: createInitialTimeframeData(16000), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
              day1: createInitialTimeframeData(16000), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
              week1: createInitialTimeframeData(16000) // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
            }
          },
          // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§ØªØ±ÛŒÙˆÙ… Ùˆ Ø¨Ø§ÛŒÙ†Ù†Ø³ Ú©ÙˆÛŒÙ† Ø¯Ø± Ø±ÛŒØ³Øª Ø¨Ø§ Ù‚ÛŒÙ…Øª Ø¬Ø¯ÛŒØ¯ Ùˆ price24hAgo
          ethereum: {
            name: "Ø§ØªØ±ÛŒÙˆÙ…",
            totalSupply: 120000000, // 120M
            livePrice: 1100, // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
            coinAmount: 0,
            avgPrice: 0,
            stopLossPrice: 0,
            price24hAgo: 1100, // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
            cycleStep: 0,
            timeframes: {
              live: createInitialTimeframeData(1100), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
              hour1: createInitialTimeframeData(1100), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
              hour4: createInitialTimeframeData(1100), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
              day1: createInitialTimeframeData(1100), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
              week1: createInitialTimeframeData(1100) // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
            }
          },
          binance: {
            name: "Ø¨Ø§ÛŒÙ†Ù†Ø³ Ú©ÙˆÛŒÙ†",
            totalSupply: 140000000, // 140M
            livePrice: 200, // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
            coinAmount: 0,
            avgPrice: 0,
            stopLossPrice: 0,
            price24hAgo: 200, // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
            cycleStep: 0,
            timeframes: {
              live: createInitialTimeframeData(200), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
              hour1: createInitialTimeframeData(200), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
              hour4: createInitialTimeframeData(200), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
              day1: createInitialTimeframeData(200), // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
              week1: createInitialTimeframeData(200) // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
            }
          }
        };
        currentCoin = 'bitcoin';
        personalCoinKey = null;
        wallet = {}; // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ú©ÛŒÙ Ù¾ÙˆÙ„
        updateCoinPercentages();
        updateDisplay();
        updateCalendarDisplay(virtualDay, virtualMonth, virtualYear);
        document.getElementById("coinNameDisplay").innerText = "Ø¨ÛŒØªÚ©ÙˆÛŒÙ†";
        // --- Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ù…ÛŒÙ†Ù†Ø³ Ø¯Ø± Ú©Ø§Ø±Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒØªÚ©ÙˆÛŒÙ† Ø¨Ø¹Ø¯ Ø§Ø² Ø±ÛŒØ³Øª ---
        document.getElementById("dominanceDisplay").style.display = 'block';
        document.getElementById("bitcoinDominanceValue").innerText = currentBitcoinDominance.toFixed(2) + "%";
        // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ ---
        // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ÙØ±Ù…Øª Ø¹Ø±Ø¶Ù‡ Ú©Ù„
        document.getElementById("totalSupplyDisplay").innerText = formatTotalSupply(21000000);
        document.getElementById("coinNameTab").innerText = "Ø¨ÛŒØªÚ©ÙˆÛŒÙ†";
        document.getElementById("coinEthereumTab").innerText = "Ø§ØªØ±ÛŒÙˆÙ…";
        document.getElementById("coinBinanceTab").innerText = "Ø¨Ø§ÛŒÙ†Ù†Ø³ Ú©ÙˆÛŒÙ†";
        document.getElementById("personalCoinTab").style.display = "none";
        const initialMarketCapInMillions = (16000 * 21000000) / 1_000_000; // ØªØºÛŒÛŒØ± Ú©Ø±Ø¯
        document.getElementById("marketCap").innerText = formatMarketCap(initialMarketCapInMillions);
        updatePriceChart();
        rsiChart.data.labels = [1];
        rsiChart.data.datasets[0].data = coins.bitcoin.timeframes.live.rsiData;
        rsiChart.update();
        document.getElementById('freezePriceBtn').innerText = 'â¸ï¸';
        document.getElementById('freezePriceBtn').title = 'ÙØ±ÛŒØ² Ù‚ÛŒÙ…Øª (Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø§Ù…Ù¾/Ø¯Ø§Ù…Ù¾)';
        // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ Ø¨Ø¹Ø¯ Ø§Ø² Ø±ÛŒØ³Øª
        document.querySelectorAll('.coin-tab').forEach(tab => tab.classList.remove('active'));
        document.getElementById('coinNameTab').classList.add('active');
        // --- Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª ØªØ¨ Ø§Ø±ØªÙ‚Ø§Ø¡ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±ØªÙ‚Ø§Ø¡ Ù¾Ø³ Ø§Ø² Ø±ÛŒØ³Øª ---
        updateUpgradeTabStatus();
        updateUpgradeButtons();
        // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ ---
        alert("Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø±ÛŒØ³Øª Ø´Ø¯.");
      }
    });
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±ÙˆÛŒØ¯Ø§Ø¯ Ú©Ù„ÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ø¬Ø¯ÛŒØ¯ Ø³ÙˆØ²Ø§Ù†Ø¯Ù†
    document.getElementById('burnBalanceBtn').addEventListener('click', burnBalanceTo1000);
    // Overlay Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§
    function showOverlay() {
      if (!document.getElementById('overlay')) {
        const overlay = document.createElement('div');
        overlay.id = 'overlay';
        document.body.appendChild(overlay);
        document.body.style.overflow = 'hidden';
      }
    }
    function hideOverlay() {
      const overlay = document.getElementById('overlay');
      if (overlay) {
        overlay.remove();
        document.body.style.overflow = '';
      }
    }
    document.getElementById('infoTab').addEventListener('click', () => {
      const infoCard = document.getElementById('infoCard');
      if (infoCard.style.display === 'none') {
        infoCard.style.display = 'block';
        showOverlay();
      } else {
        infoCard.style.display = 'none';
        hideOverlay();
      }
    });
    document.getElementById('infoCard').addEventListener('click', () => {
      document.getElementById('infoCard').style.display = 'none';
      hideOverlay();
    });
    document.getElementById('myCoinTab').addEventListener('click', () => {
      const form = document.getElementById('myCoinForm');
      if (form.style.display === 'none') {
        form.style.display = 'block';
        showOverlay();
      } else {
        form.style.display = 'none';
        hideOverlay();
      }
    });
    document.getElementById('closeMyCoinForm').addEventListener('click', () => {
      document.getElementById('myCoinForm').style.display = 'none';
        hideOverlay();
    });
    // ØªØ¨ Ù¾Ø±ÙˆÙØ§ÛŒÙ„
    document.getElementById('profileTab').addEventListener('click', () => {
      const profileCard = document.getElementById('profileCard');
      if (profileCard.style.display === 'none') {
        profileCard.style.display = 'block';
        showOverlay();
      } else {
        profileCard.style.display = 'none';
        hideOverlay();
      }
    });
    document.getElementById('profileCard').addEventListener('click', () => {
      document.getElementById('profileCard').style.display = 'none';
      hideOverlay();
    });
    // ØªØ¨ Ú©ÛŒÙ Ù¾ÙˆÙ„
    document.getElementById('walletTab').addEventListener('click', () => {
      const walletCard = document.getElementById('walletCard');
      if (walletCard.style.display === 'none') {
        walletCard.style.display = 'block';
        showOverlay();
        updateWalletDisplay(); // Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØªÙˆØ§ÛŒ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø² Ø´Ø¯Ù†
      } else {
        walletCard.style.display = 'none';
        hideOverlay();
      }
    });
    document.getElementById('walletCard').addEventListener('click', () => {
      document.getElementById('walletCard').style.display = 'none';
      hideOverlay();
    });
    // ØªØ¨ Ø§Ø±ØªÙ‚Ø§Ø¡ (Diamond) - Ø¯ÛŒÚ¯Ø± onclick Ù…Ø³ØªÙ‚ÛŒÙ… Ù†Ø¯Ø§Ø±Ø¯
    // document.getElementById('upgradeTab').addEventListener('click', showUpgradeCard); // Ø§ÛŒÙ† Ø®Ø· Ø­Ø°Ù Ø´Ø¯
    document.getElementById('upgradeCard').addEventListener('click', () => {
      document.getElementById('upgradeCard').style.display = 'none';
      hideOverlay();
    });
    // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø§Ø±ØªÙ‚Ø§Ø¡
    document.getElementById('upgradeTpsBtn').addEventListener('click', () => purchaseUpgrade('TPS'));
    document.getElementById('upgradeSecurityBtn').addEventListener('click', () => purchaseUpgrade('Security'));
    document.getElementById('upgradeConsensusBtn').addEventListener('click', () => purchaseUpgrade('Consensus'));
    document.getElementById('upgradeNftBtn').addEventListener('click', () => purchaseUpgrade('NFT'));
    document.getElementById('upgradeMarketingBtn').addEventListener('click', () => purchaseUpgrade('Marketing'));

    document.addEventListener('click', (e) => {
      if (e.target.id === 'overlay') {
        hideOverlay();
        document.getElementById('infoCard').style.display = 'none';
        document.getElementById('myCoinForm').style.display = 'none';
        document.getElementById('secretForm').style.display = 'none';
        document.getElementById('profileCard').style.display = 'none';
        document.getElementById('walletCard').style.display = 'none';
        document.getElementById('upgradeCard').style.display = 'none'; // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
      }
    });
    document.getElementById('freezePriceBtn').addEventListener('click', function() {
      isPriceFrozen = !isPriceFrozen;
      this.innerText = isPriceFrozen ? 'â–¶ï¸' : 'â¸ï¸';
      this.title = isPriceFrozen ? 'Ù‚ÛŒÙ…Øª ÙØ±ÛŒØ² Ø´Ø¯Ù‡ â€” Ù¾Ø§Ù…Ù¾/Ø¯Ø§Ù…Ù¾ ØºÛŒØ±ÙØ¹Ø§Ù„' : 'ÙØ±ÛŒØ² Ù‚ÛŒÙ…Øª (Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø§Ù…Ù¾/Ø¯Ø§Ù…Ù¾)';
      saveGame();
    });
    document.getElementById('createCoinBtn').addEventListener('click', createMyCoin);
    // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªÙ‚Ø§Ù„
    document.getElementById('transferToWalletBtn').addEventListener('click', transferToWallet);
    document.getElementById('transferFromWalletBtn').addEventListener('click', transferFromWallet);
    window.onload = () => {
      loadGame();
      initPriceChart();
      const coin = getCurrentCoinData();
      updateDisplay();
      updateCalendarDisplay(virtualDay, virtualMonth, virtualYear);
      updateCoinPercentages();
      document.getElementById("coinNameDisplay").innerText = coin.name;
      // --- Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ù…ÛŒÙ†Ù†Ø³ Ø¯Ø± Ú©Ø§Ø±Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒØªÚ©ÙˆÛŒÙ† Ø¨Ø¹Ø¯ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ---
      if (currentCoin === 'bitcoin') {
          document.getElementById("dominanceDisplay").style.display = 'block';
          document.getElementById("bitcoinDominanceValue").innerText = currentBitcoinDominance.toFixed(2) + "%";
      } else {
          document.getElementById("dominanceDisplay").style.display = 'none';
      }
      // --- Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ ---
      // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ÙØ±Ù…Øª Ø¹Ø±Ø¶Ù‡ Ú©Ù„
      document.getElementById("totalSupplyDisplay").innerText = formatTotalSupply(coin.totalSupply);
      document.getElementById("coinNameTab").innerText = "Ø¨ÛŒØªÚ©ÙˆÛŒÙ†";
      document.getElementById("coinEthereumTab").innerText = "Ø§ØªØ±ÛŒÙˆÙ…";
      document.getElementById("coinBinanceTab").innerText = "Ø¨Ø§ÛŒÙ†Ù†Ø³ Ú©ÙˆÛŒÙ†";
      document.getElementById("traderName").innerText = traderName;
      const initialMarketCapInMillions = (coin.livePrice * coin.totalSupply) / 1_000_000;
      document.getElementById("marketCap").innerText = formatMarketCap(initialMarketCapInMillions);
      setTimeFrame("live");
    };
  </script>
</body>
</html>
